var t={d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)},r={};t.d(r,{Z:()=>p});const e="attribute vec2 a_position;\r\nuniform mat3 u_matrix;\r\n\r\nvoid main() {\r\n    gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\r\n}",a="precision mediump float;\r\nuniform vec4 u_color;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_color;\r\n}";function n(t,r,e){const a=function(t,r,e){const a=t.createProgram();if(t.attachShader(a,r),t.attachShader(a,e),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS))return a;const n=t.getProgramInfoLog(a);throw t.deleteProgram(a),Error(n)}(t,i(t,t.VERTEX_SHADER,r),i(t,t.FRAGMENT_SHADER,e));return a}function i(t,r,e){const a=t.createShader(r);if(t.shaderSource(a,e),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS))return a;const n=t.getShaderInfoLog(a);throw t.deleteShader(a),Error(n)}function o(t){return t.startsWith("gl_")||t.startsWith("webgl_")}function s(t,r,e){switch(r){case t.FLOAT:return r=>t.uniform1fv(e,r);case t.FLOAT_VEC2:return r=>t.uniform2fv(e,r);case t.FLOAT_VEC3:return r=>t.uniform3fv(e,r);case t.FLOAT_VEC4:return r=>t.uniform4fv(e,r);case t.INT:return r=>t.uniform1iv(e,r);case t.INT_VEC2:return r=>t.uniform2iv(e,r);case t.INT_VEC3:return r=>t.uniform3iv(e,r);case t.INT_VEC4:return r=>t.uniform4iv(e,r);case t.FLOAT_MAT2:return r=>t.uniformMatrix2fv(e,!1,r);case t.FLOAT_MAT3:return r=>t.uniformMatrix3fv(e,!1,r);case t.FLOAT_MAT4:return r=>t.uniformMatrix4fv(e,!1,r);default:throw Error(`Type 0x${r} is invalid.`)}}function c(t,r){const e=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),a={};for(let n=0;n<e;n++){const e=t.getActiveUniform(r,n),{name:i}=e;if(!o(i)){const n=t.getUniformLocation(r,i);if(null!=n){const r=s(t,e.type,n);a[i.endsWith("[0]")?i.substr(0,i.length-3):i]=r}}}return a}function h(t,r){for(const e in r)t[e](r[e])}function l(t,r,e){const a={};for(const n in e){const i=t.getAttribLocation(r,n),o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e[n],t.STATIC_DRAW),a[n]={buffer:o,byteLength:e[n].byteLength,location:i}}return a}class u{identityMatrix(){return[1,0,0,0,1,0,0,0,1]}projectionMatrix(t,r){return[2/t,0,0,0,2/r,0,-1,-1,1]}translationMatrix(t,r){return[1,0,0,0,1,0,t,r,1]}rotationMatrix(t){const r=t/180*Math.PI,e=Math.sin(r),a=Math.cos(r);return[a,-e,0,e,a,0,0,0,1]}scaleMatrix(t,r){return[t,0,0,0,r,0,0,0,1]}arrayToMatrix(t,r){const e=[];for(let a=0;a<t.length;a+=r)e.push(t.slice(a,a+r));return e}multiplyMatrices(t,r){if(t.length===r.length&&[1,4,9,16].includes(t.length)){const e=Math.sqrt(t.length),a=this.arrayToMatrix(t,e),n=this.arrayToMatrix(r,e);return a.map(((t,r)=>n[0].map(((e,i)=>t.reduce(((t,e,o)=>t+a[r][o]*n[o][i]),0))))).flat(1)}}getTransformationMatrix(t){const r=this.identityMatrix(),e=this.projectionMatrix(t.canvas.width,t.canvas.height),a=this.translationMatrix(0,0),n=this.rotationMatrix(0),i=this.scaleMatrix(1,1);let o=this.multiplyMatrices(r,e);return o=this.multiplyMatrices(o,a),o=this.multiplyMatrices(o,n),o=this.multiplyMatrices(o,i),o}}class f{constructor(t){this.gl=t}drawLines(t){const{gl:r}=this,i=Math.max(...t.map(Math.abs)),o=this.getTickInfo(i,8),s=r.canvas.width,f=r.canvas.height,m=Math.floor(Math.min(s,f)/100),g=(f-2*m)/7,d=[],M=m,p=s-m;for(let t=1;t<=o.tickCount;t++){const r=t*g;d.push(M,r,p,r)}const _={u_color:[.7,.7,.7,1],u_matrix:(new u).getTransformationMatrix(r)},b={a_position:new Int16Array(d)},w=n(r,e,a);r.useProgram(w),h(c(r,w),_);const v=l(r,w,b);!function(t){t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}(r),r.useProgram(w),r.enableVertexAttribArray(v.a_position.location),r.bindBuffer(r.ARRAY_BUFFER,v.a_position.buffer),r.vertexAttribPointer(v.a_position.location,2,r.SHORT,!1,0,0),r.drawArrays(r.LINES,0,d.length/2)}drawBars(t){const{gl:r}=this,i=r.canvas.width,o=r.canvas.height,s=Math.floor(Math.min(i,o)/100),f=i-2*s,m=(o-2*s)/Math.max(...t),g=[],d=t.length,M=f/d;for(let r=0;r<d;r++){const e=s+t[r]*m,a=s+M*r+M/5,n=s+M*(r+1)-M/5;g.push(a,s,a,e,n,e),g.push(a,s,n,s,n,e)}const p=n(r,e,a);r.useProgram(p);const _=c(r,p),b=l(r,p,{a_position:new Float32Array(g)});h(_,{u_matrix:(new u).getTransformationMatrix(r)}),r.enableVertexAttribArray(b.a_position.location),r.bindBuffer(r.ARRAY_BUFFER,b.a_position.buffer);for(let t=0;t<d;t++)h(_,{u_color:[Math.random(),Math.random(),Math.random(),1]}),r.vertexAttribPointer(b.a_position.location,2,r.FLOAT,!1,0,12*t*Float32Array.BYTES_PER_ELEMENT),r.drawArrays(r.TRIANGLES,0,12)}getTickInfo(t,r){const e=t/r,a=Math.pow(10,Math.floor(Math.log10(e))),n=e/a,i=(n<10?[1,1.5,2,3,5,7,10].find((t=>t>n)):10)*a;return{tickHeight:i,tickCount:Math.ceil(t/i)}}}const m=class{static sliceOrFill(t,r,e){if(t.length===r)return t;if(t.length>r)return t.slice(0,r);if(t.length<r)for(;t.length!==r;)t.push(null!=e?e:0);return t}static mergeRight(t,r){const e=Object.keys(r);Object.entries(t).forEach((t=>{const a=t[0];if(e.includes(a)){const e=t[1];r[a]=e}}))}};class g{constructor(t){let r=t;if("string"==typeof r&&(r=document.getElementById(r.replace("/^#/",""))),r instanceof HTMLCanvasElement)this.context=r.getContext("webgl");else{if(!(r instanceof WebGLRenderingContext))throw Error("Argument must be valid ID, HTMLCanvasElement or WebGLRenderingContext");this.context=r}this.chartOptions={title:"Untitled",showTitle:!0,showLegend:!1},this.seriesData=[],this.chartDraftsman=new f(this.context)}setChartOptions(t){m.mergeRight(t,this.chartOptions)}setSerieOptions(t,r){r?r.forEach((r=>{const e=this.seriesData.find((t=>t.name==r));e?m.mergeRight(t,e.options):console.warn(`Serie with name ${r} not found.`)})):this.seriesData.forEach((r=>m.mergeRight(t,r.options)))}}class d extends g{constructor(t){super(t)}set X(t){this.dataLabels=t}set Y(t){const{length:r}=this.dataLabels;if(!r)throw Error('Values on "X" axis must be specified before setting "Y" values.');const e=t.map((t=>m.sliceOrFill(t,r)));this.seriesData=e.map(((t,r)=>this.getDefaultSerieObject(t,r)))}getDefaultSerieObject(t,r){return{values:t,name:`serie${r}`,options:{color:{r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:255},showLabels:!1,showOnLegend:!1,edgeThickness:0}}}draw(){this.chartDraftsman.drawLines(this.seriesData[0].values),this.chartDraftsman.drawBars(this.seriesData[0].values)}}class M extends g{constructor(t){super(t)}set X(t){this.seriesData=t.map((t=>this.getDefaultSerieObject(t)))}set Y(t){const{length:r}=this.seriesData;if(!r)throw Error('Values on "X" axis must be specified before setting "Y" values.');const e=m.sliceOrFill(t,r);this.seriesData.map(((t,r)=>{t.value=e[r]}))}getDefaultSerieObject(t){return{value:0,name:t,options:{color:{r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:255},showLabels:!1,showOnLegend:!1,edgeThickness:0}}}draw(){throw Error("Not implemented yet")}}function p(t,r){switch(t.toLowerCase().trim()){case"pie":return new M(r);case"bar":return new d(r);default:throw new Error(`${t} chart is not defined.`)}}var _=r.Z;export{_ as default};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bEgsS0FBS2lHLFdBQ0RpQixFQUFPaEgsS0FBS2tJLEdBQVVwSSxLQUFLd0gsc0JBQXNCWSxLQUc5Q2hCLE1BQUVLLEdBQ1QsTUFBTSxPQUFFekssR0FBV2dELEtBQUtpRyxXQUN4QixJQUFLakosRUFDRCxNQUFNdEQsTUFBTSxtRUFDaEIsTUFBTTJPLEVBQWVoQyxFQUFXaUIsWUFBWUcsRUFBUXpLLEdBQ3BEZ0QsS0FBS2lHLFdBQVcvRixLQUFJLENBQUNvSSxFQUFRZixLQUN6QmUsRUFBT25ELE1BQVFrRCxFQUFhZCxNQUk1QkMsc0JBQXNCWSxHQUMxQixNQUFPLENBQ0hqRCxNQUFPLEVBQ1AxSyxLQUFNMk4sRUFDTmhDLFFBQVMsQ0FDTHNCLE1BQU8sQ0FDSEMsRUFBR2pKLEtBQUs4QyxNQUFzQixJQUFoQjlDLEtBQUtrRixVQUNuQmdFLEVBQUdsSixLQUFLOEMsTUFBc0IsSUFBaEI5QyxLQUFLa0YsVUFDbkJpRSxFQUFHbkosS0FBSzhDLE1BQXNCLElBQWhCOUMsS0FBS2tGLFVBQ25Ca0UsRUFBRyxLQUVQQyxZQUFZLEVBQ1pDLGNBQWMsRUFDZEMsY0FBZSxJQUtwQkMsT0FDSCxNQUFNeE8sTUFBTSx3QkN6Q0wsU0FBUzZPLEVBQVd4TyxFQUFjQyxHQUM3QyxPQUFRRCxFQUFLeU8sY0FBY0MsUUFDdkIsSUFBSyxNQUNELE9BQU8sSUFBSU4sRUFBU25PLEdBQ3hCLElBQUssTUFDRCxPQUFPLElBQUkrTSxFQUFTL00sR0FDeEIsUUFDSSxNQUFNLElBQUlOLE1BQU0sR0FBR0ssNEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL3NoYWRlcnMvdnMuZ2xzbCIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL3NoYWRlcnMvZnMuZ2xzbCIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL3Bsb3QtbG9naWMvUGxvdFV0aWxzLnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvcGxvdC1sb2dpYy9NYXRoVXRpbHMudHMiLCJ3ZWJwYWNrOi8vQGJyei93ZWJnbC1jaGFydC8uL3NyYy9wbG90LWxvZ2ljL0NoYXJ0RHJhZnRzbWFuLnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvY29tcG9uZW50cy9DaGFydFV0aWxzLnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvY29tcG9uZW50cy9DaGFydC50cyIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL2NvbXBvbmVudHMvQmFyQ2hhcnQudHMiLCJ3ZWJwYWNrOi8vQGJyei93ZWJnbC1jaGFydC8uL3NyYy9jb21wb25lbnRzL1BpZUNoYXJ0LnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvY29tcG9uZW50cy9DaGFydFNlcnZhbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJleHBvcnQgZGVmYXVsdCBcImF0dHJpYnV0ZSB2ZWMyIGFfcG9zaXRpb247XFxyXFxudW5pZm9ybSBtYXQzIHVfbWF0cml4O1xcclxcblxcclxcbnZvaWQgbWFpbigpIHtcXHJcXG4gICAgZ2xfUG9zaXRpb24gPSB2ZWM0KCh1X21hdHJpeCAqIHZlYzMoYV9wb3NpdGlvbiwgMSkpLnh5LCAwLCAxKTtcXHJcXG59XCIiLCJleHBvcnQgZGVmYXVsdCBcInByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xcclxcbnVuaWZvcm0gdmVjNCB1X2NvbG9yO1xcclxcblxcclxcbnZvaWQgbWFpbigpIHtcXHJcXG4gICAgZ2xfRnJhZ0NvbG9yID0gdV9jb2xvcjtcXHJcXG59XCIiLCIvKlxyXG5CYXNlZCBvbiAndHdnbHMuanMnIGJ5IEdyZWdnIFRhdmFyZXMuXHJcblJlYXNvbiBiZWhpbmQgbm90IHVzaW5nIHRoaXMgbGlicmFyeSBkaXJlY3RseSBhcmU6XHJcbi0gZGVzaXJlIHRvIHJlY3JlYXRlIGxpYiB0byB1bmRlcnN0YW5kIHVuZGVybHlpbmcgZnVuY3Rpb25hbGl0eSBiZXR0ZXJcclxuLSBwcm9ibGVtcyB3aXRoIGluY2x1ZGluZyBtNCBhbmQgdmVjM1xyXG4tIGl0IHdlaWdodHMgdG9vIG11Y2hcclxuKi9cclxuXHJcbnR5cGUgVW5pZm9ybVNldHRlckZ1bmN0aW9uID0gKGRhdGE6IG51bWJlcltdKSA9PiB2b2lkO1xyXG50eXBlIFVuaWZvcm1TZXR0ZXJzT2JqZWN0ID0gUmVjb3JkPHN0cmluZywgVW5pZm9ybVNldHRlckZ1bmN0aW9uPjtcclxuaW50ZXJmYWNlIEF0dHJpYnV0ZUJ1ZmZlck9iamVjdCB7XHJcbiAgICBidWZmZXI6IFdlYkdMQnVmZmVyO1xyXG4gICAgYnl0ZUxlbmd0aDogbnVtYmVyO1xyXG4gICAgbG9jYXRpb246IG51bWJlcjtcclxufVxyXG50eXBlIEF0dHJpYnV0ZUJ1ZmZlck9iamVjdHMgPSBSZWNvcmQ8c3RyaW5nLCBBdHRyaWJ1dGVCdWZmZXJPYmplY3Q+O1xyXG5cclxuLyoqXHJcbiAqIFJlc2l6ZSBjYW52YXMgdG8gZGlzcGxheSBzaXplLlxyXG4gKiBAcGFyYW0gY2FudmFzIC0gY2FudmFzIG9iamVjdC5cclxuICogQHJldHVybnMgZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgcmVzaXplIG9jY3VyZWQuXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiByZXNpemVDYW52YXNUb0Rpc3BsYXlTaXplKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHdpZHRoID0gY2FudmFzLmNsaWVudFdpZHRoO1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gY2FudmFzLmNsaWVudEhlaWdodDtcclxuICAgIGlmIChjYW52YXMud2lkdGggIT09IHdpZHRoIHx8IGNhbnZhcy5oZWlnaHQgIT09IGhlaWdodCkge1xyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIHByb2dyYW0gd2l0aCBhdHRhY2hlZCBzaGFkZXJzLlxyXG4gKiBAcGFyYW0gZ2wgLSBjb250ZXh0LlxyXG4gKiBAcGFyYW0gdnMgLSB2ZXJ0ZXggc2hhZGVyIHN0cmluZyBzb3VyY2UuXHJcbiAqIEBwYXJhbSBmcyAtIGZyYWdtZW50IHNoYWRlciBzdHJpbmcgc291cmNlLlxyXG4gKiBAcmV0dXJucyBsaW5rZWQgcHJvZ3JhbSB3aXRoIGF0dGFjaGVkIHNoYWRlcnMuXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQcm9ncmFtKGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQsIHZzOiBzdHJpbmcsIGZzOiBzdHJpbmcpOiBXZWJHTFByb2dyYW0ge1xyXG4gICAgY29uc3QgdmVydGV4U2hhZGVyID0gY3JlYXRlU2hhZGVyKGdsLCBnbC5WRVJURVhfU0hBREVSLCB2cyk7XHJcbiAgICBjb25zdCBmcmFnbWVudFNoYWRlciA9IGNyZWF0ZVNoYWRlcihnbCwgZ2wuRlJBR01FTlRfU0hBREVSLCBmcyk7XHJcbiAgICBjb25zdCBwcm9ncmFtID0gY3JlYXRlUHJvZ3JhbUZyb21TaGFkZXJzKGdsLCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyKTtcclxuICAgIHJldHVybiBwcm9ncmFtO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBzaGFkZXIuXHJcbiAqIEBwYXJhbSBnbCAtIGNvbnRleHQuXHJcbiAqIEBwYXJhbSB0eXBlIC0gdHlwZSBvZiBzaGFkZXIgKGdsLlZFUlRFWF9TSEFERVIsIGdsLkZSQUdNRU5UX1NIQURFUikuXHJcbiAqIEBwYXJhbSBzb3VyY2UgLSBzaGFkZXIgc3RyaW5nIHNvdXJjZS5cclxuICogQHJldHVybnMgY29tcGlsZWQgc2hhZGVyLlxyXG4qL1xyXG5mdW5jdGlvbiBjcmVhdGVTaGFkZXIoZ2w6IFdlYkdMUmVuZGVyaW5nQ29udGV4dCwgdHlwZTogbnVtYmVyLCBzb3VyY2U6IHN0cmluZyk6IFdlYkdMU2hhZGVyIHtcclxuICAgIGNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcih0eXBlKTtcclxuICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIHNvdXJjZSk7XHJcbiAgICBnbC5jb21waWxlU2hhZGVyKHNoYWRlcik7XHJcblxyXG4gICAgY29uc3Qgc3VjY2VzcyA9IGdsLmdldFNoYWRlclBhcmFtZXRlcihzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKTtcclxuICAgIGlmIChzdWNjZXNzKSByZXR1cm4gc2hhZGVyO1xyXG5cclxuICAgIGNvbnN0IGxvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTtcclxuICAgIGdsLmRlbGV0ZVNoYWRlcihzaGFkZXIpO1xyXG4gICAgdGhyb3cgRXJyb3IobG9nKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgcHJvZ3JhbSBoYXZpbmcgc2hhZGVycyBjb21waWxlZC5cclxuICogQHBhcmFtIGdsIC0gY29udGV4dC5cclxuICogQHBhcmFtIHZzTyAtIHZlcnRleCBzaGFkZXIuXHJcbiAqIEBwYXJhbSBmc08gLSBmcmFnbWVudCBzaGFkZXIuXHJcbiAqIEByZXR1cm5zIGxpbmtlZCBwcm9ncmFtLlxyXG4qL1xyXG5mdW5jdGlvbiBjcmVhdGVQcm9ncmFtRnJvbVNoYWRlcnMoZ2w6IFdlYkdMUmVuZGVyaW5nQ29udGV4dCwgdnNPOiBXZWJHTFNoYWRlciwgZnNPOiBXZWJHTFNoYWRlcik6IFdlYkdMUHJvZ3JhbSB7XHJcbiAgICBjb25zdCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xyXG4gICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZzTyk7XHJcbiAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZnNPKTtcclxuICAgIGdsLmxpbmtQcm9ncmFtKHByb2dyYW0pO1xyXG5cclxuICAgIGNvbnN0IHN1Y2Nlc3MgPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIGdsLkxJTktfU1RBVFVTKTtcclxuICAgIGlmIChzdWNjZXNzKSByZXR1cm4gcHJvZ3JhbTtcclxuXHJcbiAgICBjb25zdCBsb2cgPSBnbC5nZXRQcm9ncmFtSW5mb0xvZyhwcm9ncmFtKTtcclxuICAgIGdsLmRlbGV0ZVByb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICB0aHJvdyBFcnJvcihsb2cpO1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIHZpZXdwb3J0IGFuZCBwcmVwYXJlIGNhbnZhcy5cclxuICogQHBhcmFtIGdsIC0gY29udGV4dC5cclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHByZXBhcmVWaWV3KGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQpOiB2b2lkIHtcclxuICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCk7XHJcbiAgICBnbC5jbGVhckNvbG9yKDAsIDAsIDAsIDApO1xyXG4gICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcmV0dXJuIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIGF0dHJpYnV0ZSBvciB1bmlmb3JtIGlzIGJ1aWx0LWluLlxyXG4qL1xyXG5mdW5jdGlvbiBpc0J1aWx0SW4obmFtZTogV2ViR0xBY3RpdmVJbmZvWyduYW1lJ10pOiBib29sZWFuIHtcclxuICAgIHJldHVybiBuYW1lLnN0YXJ0c1dpdGgoXCJnbF9cIikgfHwgbmFtZS5zdGFydHNXaXRoKFwid2ViZ2xfXCIpO1xyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIGdsIC0gY29udGV4dC5cclxuICogQHBhcmFtIHR5cGUgLSB0eXBlIG9mIHVuaWZvcm0uXHJcbiAqIEBwYXJhbSBsb2MgLSBsb2NhdGlvbiBvZiB1bmlmb3JtIGluIHByb2dyYW0uXHJcbiAqIEByZXR1cm4gc2V0dGVyIGZvciB1bmlmb3JtLlxyXG4qL1xyXG5mdW5jdGlvbiBnZXRVbmlmb3JtU2V0dGVyQnlUeXBlKGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQsIHR5cGU6IFdlYkdMQWN0aXZlSW5mb1sndHlwZSddLCBsb2M6IFdlYkdMVW5pZm9ybUxvY2F0aW9uKTogVW5pZm9ybVNldHRlckZ1bmN0aW9uIHtcclxuICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgIGNhc2UgZ2wuRkxPQVQ6XHJcbiAgICAgICAgICAgIHJldHVybiAoZGF0YSk6IHZvaWQgPT4gZ2wudW5pZm9ybTFmdihsb2MsIGRhdGEpO1xyXG4gICAgICAgIGNhc2UgZ2wuRkxPQVRfVkVDMjpcclxuICAgICAgICAgICAgcmV0dXJuIChkYXRhKTogdm9pZCA9PiBnbC51bmlmb3JtMmZ2KGxvYywgZGF0YSk7XHJcbiAgICAgICAgY2FzZSBnbC5GTE9BVF9WRUMzOlxyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGEpOiB2b2lkID0+IGdsLnVuaWZvcm0zZnYobG9jLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLkZMT0FUX1ZFQzQ6XHJcbiAgICAgICAgICAgIHJldHVybiAoZGF0YSk6IHZvaWQgPT4gZ2wudW5pZm9ybTRmdihsb2MsIGRhdGEpO1xyXG4gICAgICAgIGNhc2UgZ2wuSU5UOlxyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGEpOiB2b2lkID0+IGdsLnVuaWZvcm0xaXYobG9jLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLklOVF9WRUMyOlxyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGEpOiB2b2lkID0+IGdsLnVuaWZvcm0yaXYobG9jLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLklOVF9WRUMzOlxyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGEpOiB2b2lkID0+IGdsLnVuaWZvcm0zaXYobG9jLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLklOVF9WRUM0OlxyXG4gICAgICAgICAgICByZXR1cm4gKGRhdGEpOiB2b2lkID0+IGdsLnVuaWZvcm00aXYobG9jLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLkZMT0FUX01BVDI6XHJcbiAgICAgICAgICAgIHJldHVybiAoZGF0YSk6IHZvaWQgPT4gZ2wudW5pZm9ybU1hdHJpeDJmdihsb2MsIGZhbHNlLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLkZMT0FUX01BVDM6XHJcbiAgICAgICAgICAgIHJldHVybiAoZGF0YSk6IHZvaWQgPT4gZ2wudW5pZm9ybU1hdHJpeDNmdihsb2MsIGZhbHNlLCBkYXRhKTtcclxuICAgICAgICBjYXNlIGdsLkZMT0FUX01BVDQ6XHJcbiAgICAgICAgICAgIHJldHVybiAoZGF0YSk6IHZvaWQgPT4gZ2wudW5pZm9ybU1hdHJpeDRmdihsb2MsIGZhbHNlLCBkYXRhKTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgVHlwZSAweCR7dHlwZX0gaXMgaW52YWxpZC5gKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZXMgdW5pZm9ybSBzZXR0ZXJzIHRvIGVhc2lseSBzZXQgdW5pZm9ybXMgbG9jYXRlZCBpbiBwcm9ncmFtLlxyXG4gKiBAcGFyYW0gZ2wgLSBjb250ZXh0LlxyXG4gKiBAcGFyYW0gcHJvZ3JhbSAtIHByb2dyYW0gaW4gd2hpY2ggdW5pZm9ybXMgYXJlIGxvY2F0ZWQuXHJcbiAqIEByZXR1cm4gPHVuaWZvcm0gbmFtZSwgc2V0dGVyIGZvciB1bmlmb3JtPiBwYWlycy5cclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVVuaWZvcm1TZXR0ZXJzKGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQsIHByb2dyYW06IFdlYkdMUHJvZ3JhbSk6IFVuaWZvcm1TZXR0ZXJzT2JqZWN0IHtcclxuICAgIGNvbnN0IG51bVVuaWZvcm1zID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihwcm9ncmFtLCBnbC5BQ1RJVkVfVU5JRk9STVMpO1xyXG4gICAgY29uc3QgdW5pZm9ybVNldHRlcnM6IFVuaWZvcm1TZXR0ZXJzT2JqZWN0ID0ge307XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Vbmlmb3JtczsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgdW5pZm9ybUluZm8gPSBnbC5nZXRBY3RpdmVVbmlmb3JtKHByb2dyYW0sIGkpO1xyXG4gICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gdW5pZm9ybUluZm87XHJcbiAgICAgICAgaWYgKCFpc0J1aWx0SW4obmFtZSkpIHtcclxuICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgbmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChsb2NhdGlvbiAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZXR0ZXIgPSBnZXRVbmlmb3JtU2V0dGVyQnlUeXBlKGdsLCB1bmlmb3JtSW5mby50eXBlLCBsb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJOYW1lID0gbmFtZS5lbmRzV2l0aCgnWzBdJykgPyBuYW1lLnN1YnN0cigwLCBuYW1lLmxlbmd0aCAtIDMpIDogbmFtZTtcclxuICAgICAgICAgICAgICAgIHVuaWZvcm1TZXR0ZXJzW3N1Yk5hbWVdID0gc2V0dGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuaWZvcm1TZXR0ZXJzO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0cyB1bmlmb3JtcyB1c2luZyAnZGF0YScgYW5kIHNldHRlcnMgc3BlY2lmaWVkIGluICdzZXR0ZXJzJy4gXHJcbiAqIEBwYXJhbSBzZXR0ZXJzIC0gc2V0dGVycyBjcmVhdGVkIHZpYSB7QGxpbmsgY3JlYXRlVW5pZm9ybVNldHRlcnN9LlxyXG4gKiBAcGFyYW0gZGF0YSAtIGRhdGEgZm9yIHNldHRlcnMsIGtleXMgc2hvdWxkIG1hdGNoIHNldHRlciBrZXlzLlxyXG4gKiBAcmV0dXJuIDx1bmlmb3JtIG5hbWUsIHNldHRlciBmb3IgdW5pZm9ybT4gcGFpcnMuXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXRVbmlmb3JtcyhzZXR0ZXJzOiBVbmlmb3JtU2V0dGVyc09iamVjdCwgZGF0YTogUmVjb3JkPHN0cmluZywgbnVtYmVyW10+KTogdm9pZCB7XHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gaW4gZGF0YSkge1xyXG4gICAgICAgIHNldHRlcnNbaXRlbV0oZGF0YVtpdGVtXSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIHVuaWZvcm0gZm9yIGVhY2ggYXR0cmlidXRlIChhcyBrZXkpIGluIGRhdGFcclxuICogYW5kIHN0b3JlcyBkYXRhIChhcyB2YWx1ZSBmb3Iga2V5KSBpbiB0aGlzIGJ1ZmZlci5cclxuICogQHBhcmFtIGdsIC0gY29udGV4dC5cclxuICogQHBhcmFtIHByb2dyYW0gLSBwcm9ncmFtLlxyXG4gKiBAcGFyYW0gZGF0YSAtIDxhdHRyaWJ1dGUsIEJ1ZmZlclNvdXJjZT4gcGFpcnMuXHJcbiAqIEByZXR1cm4gYnVmZmVyIHdpdGggZGF0YSwgbGVuZ2h0IGluIGJ5dGVzIG9mIGJ1ZmZlciBlbGVtZW50LCBsb2NhdGlvbiBvZiBhdHRyaWJ1dGUuXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCdWZmZXJzRm9yQXR0cmlidXRlcyhnbDogV2ViR0xSZW5kZXJpbmdDb250ZXh0LCBwcm9ncmFtOiBXZWJHTFByb2dyYW0sIGRhdGE6IFJlY29yZDxzdHJpbmcsIEJ1ZmZlclNvdXJjZT4pOiBBdHRyaWJ1dGVCdWZmZXJPYmplY3RzIHtcclxuICAgIGNvbnN0IGJ1ZmZlckluZm86IEF0dHJpYnV0ZUJ1ZmZlck9iamVjdHMgPSB7fTtcclxuICAgIGZvciAoY29uc3QgYXR0cmliIGluIGRhdGEpIHtcclxuICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIGF0dHJpYik7XHJcbiAgICAgICAgY29uc3QgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7XHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIGRhdGFbYXR0cmliXSwgZ2wuU1RBVElDX0RSQVcpO1xyXG4gICAgICAgIGJ1ZmZlckluZm9bYXR0cmliXSA9IHtcclxuICAgICAgICAgICAgYnVmZmVyLFxyXG4gICAgICAgICAgICBieXRlTGVuZ3RoOiBkYXRhW2F0dHJpYl0uYnl0ZUxlbmd0aCxcclxuICAgICAgICAgICAgbG9jYXRpb25cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGJ1ZmZlckluZm87XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBNYXRoVXRpbHMge1xyXG4gICAgaWRlbnRpdHlNYXRyaXgoKTogbnVtYmVyW10ge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgIDEsIDAsIDAsXHJcbiAgICAgICAgICAgIDAsIDEsIDAsXHJcbiAgICAgICAgICAgIDAsIDAsIDEsXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuICAgIC8vIFJ5c293YW5pZSBvZCBkb2xuZWdvIGxld2VnbyByb2d1LlxyXG4gICAgLy8gQ2hjxIVjIHJ5c293YcSHIG9kIGfDs3JuZWdvIGxld2VnbyxcclxuICAgIC8vIHptaWVuacSHIG5hIC0yL2hlaWdodCBvcmF6ICsxXHJcbiAgICBwcm9qZWN0aW9uTWF0cml4KHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogbnVtYmVyW10ge1xyXG4gICAgICAgIHJldHVybiBbXHJcbiAgICAgICAgICAgIDIgLyB3aWR0aCwgMCwgMCxcclxuICAgICAgICAgICAgMCwgMiAvIGhlaWdodCwgMCxcclxuICAgICAgICAgICAgLTEsIC0xLCAxXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuICAgIHRyYW5zbGF0aW9uTWF0cml4KHR4OiBudW1iZXIsIHR5OiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgMSwgMCwgMCxcclxuICAgICAgICAgICAgMCwgMSwgMCxcclxuICAgICAgICAgICAgdHgsIHR5LCAxLFxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcbiAgICByb3RhdGlvbk1hdHJpeChkZWdyZWVzOiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgY29uc3QgcmFkaWFucyA9IGRlZ3JlZXMgLyAxODAgKiBNYXRoLlBJO1xyXG4gICAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihyYWRpYW5zKTtcclxuICAgICAgICBjb25zdCBjID0gTWF0aC5jb3MocmFkaWFucyk7XHJcbiAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgYywgLXMsIDAsXHJcbiAgICAgICAgICAgIHMsIGMsIDAsXHJcbiAgICAgICAgICAgIDAsIDAsIDEsXHJcbiAgICAgICAgXTtcclxuICAgIH1cclxuICAgIHNjYWxlTWF0cml4KHN4OiBudW1iZXIsIHN5OiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIFtcclxuICAgICAgICAgICAgc3gsIDAsIDAsXHJcbiAgICAgICAgICAgIDAsIHN5LCAwLFxyXG4gICAgICAgICAgICAwLCAwLCAxLFxyXG4gICAgICAgIF07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhcnJheVRvTWF0cml4KGFycjogbnVtYmVyW10sIHNpemU6IG51bWJlcik6IG51bWJlcltdW10ge1xyXG4gICAgICAgIGNvbnN0IHJlczogbnVtYmVyW11bXSA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSArPSBzaXplKVxyXG4gICAgICAgICAgICByZXMucHVzaChhcnIuc2xpY2UoaSwgaSArIHNpemUpKTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHVzZSBtYXRoLmpzIGlmIG5lZWRlZCAtIGNvZGUgYnkgSmFuIFR1cm/FiFxyXG4gICAgbXVsdGlwbHlNYXRyaWNlcyhGOiBudW1iZXJbXSwgUzogbnVtYmVyW10pOiBudW1iZXJbXSB7XHJcbiAgICAgICAgaWYgKEYubGVuZ3RoID09PSBTLmxlbmd0aCAmJiBbMSwgNCwgOSwgMTZdLmluY2x1ZGVzKEYubGVuZ3RoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBwb3cgPSBNYXRoLnNxcnQoRi5sZW5ndGgpO1xyXG4gICAgICAgICAgICBjb25zdCBBID0gdGhpcy5hcnJheVRvTWF0cml4KEYsIHBvdyk7XHJcbiAgICAgICAgICAgIGNvbnN0IEIgPSB0aGlzLmFycmF5VG9NYXRyaXgoUywgcG93KTtcclxuICAgICAgICAgICAgcmV0dXJuIEEubWFwKChyb3csIGkpID0+XHJcbiAgICAgICAgICAgICAgICBCWzBdLm1hcCgoXywgaikgPT5cclxuICAgICAgICAgICAgICAgICAgICByb3cucmVkdWNlKChhY2MsIF8sIG4pID0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYyArIEFbaV1bbl0gKiBCW25dW2pdLCAwXHJcbiAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApLmZsYXQoMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFRyYW5zZm9ybWF0aW9uTWF0cml4KGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb25YID0gMDtcclxuICAgICAgICBjb25zdCB0cmFuc2xhdGlvblkgPSAwO1xyXG4gICAgICAgIGNvbnN0IHJvdGF0aW9uSW5EZWdyZWVzID0gMDtcclxuICAgICAgICBjb25zdCBzY2FsZVggPSAxO1xyXG4gICAgICAgIGNvbnN0IHNjYWxlWSA9IDE7XHJcblxyXG4gICAgICAgIGNvbnN0IGlkZW50aXR5TWF0cml4ID0gdGhpcy5pZGVudGl0eU1hdHJpeCgpO1xyXG4gICAgICAgIGNvbnN0IHByb2plY3Rpb25NYXRyaXggPSB0aGlzLnByb2plY3Rpb25NYXRyaXgoZ2wuY2FudmFzLndpZHRoLCBnbC5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICBjb25zdCB0cmFuc2xhdGlvbk1hdHJpeCA9IHRoaXMudHJhbnNsYXRpb25NYXRyaXgodHJhbnNsYXRpb25YLCB0cmFuc2xhdGlvblkpO1xyXG4gICAgICAgIGNvbnN0IHJvdGF0aW9uTWF0cml4ID0gdGhpcy5yb3RhdGlvbk1hdHJpeChyb3RhdGlvbkluRGVncmVlcyk7XHJcbiAgICAgICAgY29uc3Qgc2NhbGVNYXRyaXggPSB0aGlzLnNjYWxlTWF0cml4KHNjYWxlWCwgc2NhbGVZKTtcclxuXHJcbiAgICAgICAgbGV0IG1hdHJpeCA9IHRoaXMubXVsdGlwbHlNYXRyaWNlcyhpZGVudGl0eU1hdHJpeCwgcHJvamVjdGlvbk1hdHJpeCk7XHJcbiAgICAgICAgbWF0cml4ID0gdGhpcy5tdWx0aXBseU1hdHJpY2VzKG1hdHJpeCwgdHJhbnNsYXRpb25NYXRyaXgpO1xyXG4gICAgICAgIG1hdHJpeCA9IHRoaXMubXVsdGlwbHlNYXRyaWNlcyhtYXRyaXgsIHJvdGF0aW9uTWF0cml4KTtcclxuICAgICAgICBtYXRyaXggPSB0aGlzLm11bHRpcGx5TWF0cmljZXMobWF0cml4LCBzY2FsZU1hdHJpeCk7XHJcbiAgICAgICAgcmV0dXJuIG1hdHJpeDtcclxuICAgIH1cclxufSIsImltcG9ydCB2c0xpbmVzIGZyb20gJy4uL3NoYWRlcnMvdnMuZ2xzbCc7XHJcbmltcG9ydCBmc0xpbmVzIGZyb20gJy4uL3NoYWRlcnMvZnMuZ2xzbCc7XHJcbmltcG9ydCB7IFRpY2tJbmZvIH0gZnJvbSAnLi4vbW9kZWxzJztcclxuaW1wb3J0IHsgY3JlYXRlQnVmZmVyc0ZvckF0dHJpYnV0ZXMsIGNyZWF0ZVByb2dyYW0sIGNyZWF0ZVVuaWZvcm1TZXR0ZXJzLCBwcmVwYXJlVmlldywgc2V0VW5pZm9ybXMgfSBmcm9tICcuL1Bsb3RVdGlscyc7XHJcbmltcG9ydCBNYXRoVXRpbHMgZnJvbSAnLi9NYXRoVXRpbHMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2hhcnREcmFmdHNtYW4ge1xyXG5cclxuICAgIGdsOiBXZWJHTFJlbmRlcmluZ0NvbnRleHQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZ2w6IFdlYkdMUmVuZGVyaW5nQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuZ2wgPSBnbDtcclxuICAgIH1cclxuXHJcbiAgICBkcmF3TGluZXMoc2VyaWVzOiBudW1iZXJbXSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHsgZ2wgfSA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgbWF4ID0gTWF0aC5tYXgoLi4uc2VyaWVzLm1hcChNYXRoLmFicykpO1xyXG4gICAgICAgIGNvbnN0IHRpY2tJbmZvID0gdGhpcy5nZXRUaWNrSW5mbyhtYXgsIDgpO1xyXG4gICAgICAgIGNvbnN0IHcgPSBnbC5jYW52YXMud2lkdGg7XHJcbiAgICAgICAgY29uc3QgaCA9IGdsLmNhbnZhcy5oZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgcGFkZGluZyA9IE1hdGguZmxvb3IoTWF0aC5taW4odywgaCkgLyAxMDApO1xyXG4gICAgICAgIGNvbnN0IHVuZGVyTGluZUFyZWFIZWlnaHQgPSAoaCAtIDIgKiBwYWRkaW5nKSAvIDc7XHJcbiAgICAgICAgY29uc3QgbGluZXNQb2ludHMgPSBbXTtcclxuICAgICAgICBjb25zdCBzdGFydCA9IHBhZGRpbmc7XHJcbiAgICAgICAgY29uc3QgZW5kID0gdyAtIHBhZGRpbmc7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGlja0luZm8udGlja0NvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgbGluZUggPSBpICogdW5kZXJMaW5lQXJlYUhlaWdodDtcclxuICAgICAgICAgICAgbGluZXNQb2ludHMucHVzaChzdGFydCwgbGluZUgsIGVuZCwgbGluZUgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdSA9IG5ldyBNYXRoVXRpbHMoKTtcclxuICAgICAgICBjb25zdCB1bmlmb3JtcyA9IHtcclxuICAgICAgICAgICAgdV9jb2xvcjogWzAuNywgMC43LCAwLjcsIDFdLFxyXG4gICAgICAgICAgICB1X21hdHJpeDogdS5nZXRUcmFuc2Zvcm1hdGlvbk1hdHJpeChnbClcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGFycmF5cyA9IHtcclxuICAgICAgICAgICAgYV9wb3NpdGlvbjogbmV3IEludDE2QXJyYXkobGluZXNQb2ludHMpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBwcm9ncmFtID0gY3JlYXRlUHJvZ3JhbShnbCwgdnNMaW5lcywgZnNMaW5lcyk7XHJcbiAgICAgICAgZ2wudXNlUHJvZ3JhbShwcm9ncmFtKTtcclxuICAgICAgICBjb25zdCBzZXR0ZXJzID0gY3JlYXRlVW5pZm9ybVNldHRlcnMoZ2wsIHByb2dyYW0pO1xyXG4gICAgICAgIHNldFVuaWZvcm1zKHNldHRlcnMsIHVuaWZvcm1zKTtcclxuICAgICAgICBjb25zdCBidWZmZXJzID0gY3JlYXRlQnVmZmVyc0ZvckF0dHJpYnV0ZXMoZ2wsIHByb2dyYW0sIGFycmF5cyk7XHJcbiAgICAgICAgcHJlcGFyZVZpZXcoZ2wpO1xyXG5cclxuICAgICAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGJ1ZmZlcnMuYV9wb3NpdGlvbi5sb2NhdGlvbik7XHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcnMuYV9wb3NpdGlvbi5idWZmZXIpO1xyXG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoYnVmZmVycy5hX3Bvc2l0aW9uLmxvY2F0aW9uLCAyLCBnbC5TSE9SVCwgZmFsc2UsIDAsIDApO1xyXG4gICAgICAgIGdsLmRyYXdBcnJheXMoZ2wuTElORVMsIDAsIGxpbmVzUG9pbnRzLmxlbmd0aCAvIDIpO1xyXG4gICAgfVxyXG5cclxuICAgIGRyYXdCYXJzKHNlcmllczogbnVtYmVyW10pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCB7IGdsIH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHcgPSBnbC5jYW52YXMud2lkdGg7XHJcbiAgICAgICAgY29uc3QgaCA9IGdsLmNhbnZhcy5oZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgcGFkZGluZyA9IE1hdGguZmxvb3IoTWF0aC5taW4odywgaCkgLyAxMDApOyAvL25wIDYgLSB3dGVkeSBIID0gNTg4LlxyXG4gICAgICAgIGNvbnN0IEggPSBoIC0gMiAqIHBhZGRpbmc7XHJcbiAgICAgICAgY29uc3QgVyA9IHcgLSAyICogcGFkZGluZztcclxuICAgICAgICBjb25zdCBtdWx0aXBpZXIgPSBIIC8gTWF0aC5tYXgoLi4uc2VyaWVzKTtcclxuXHJcbiAgICAgICAgY29uc3QgY29sUG9pbnRzID0gW107XHJcbiAgICAgICAgY29uc3QgQ09MX05VTVMgPSBzZXJpZXMubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IGNvbEFyZWFXaWR0aCA9IFcgLyBDT0xfTlVNUztcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBDT0xfTlVNUzsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbEhlaWdodCA9IHBhZGRpbmcgKyBzZXJpZXNbaV0gKiBtdWx0aXBpZXI7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvaW50TGVmdFggPSBwYWRkaW5nICsgKGNvbEFyZWFXaWR0aCAqIGkpICsgKGNvbEFyZWFXaWR0aCAvIDUpO1xyXG4gICAgICAgICAgICBjb25zdCBwb2ludExlZnRZID0gcGFkZGluZyArIChjb2xBcmVhV2lkdGggKiAoaSArIDEpKSAtIChjb2xBcmVhV2lkdGggLyA1KTtcclxuICAgICAgICAgICAgY29sUG9pbnRzLnB1c2gocG9pbnRMZWZ0WCwgcGFkZGluZywgcG9pbnRMZWZ0WCwgY29sSGVpZ2h0LCBwb2ludExlZnRZLCBjb2xIZWlnaHQpO1xyXG4gICAgICAgICAgICBjb2xQb2ludHMucHVzaChwb2ludExlZnRYLCBwYWRkaW5nLCBwb2ludExlZnRZLCBwYWRkaW5nLCBwb2ludExlZnRZLCBjb2xIZWlnaHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcHJvZ3JhbSA9IGNyZWF0ZVByb2dyYW0oZ2wsIHZzTGluZXMsIGZzTGluZXMpO1xyXG4gICAgICAgIGdsLnVzZVByb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICAgICAgY29uc3Qgc2V0dGVycyA9IGNyZWF0ZVVuaWZvcm1TZXR0ZXJzKGdsLCBwcm9ncmFtKTtcclxuXHJcbiAgICAgICAgY29uc3QgYXJyYXlzID0ge1xyXG4gICAgICAgICAgICBhX3Bvc2l0aW9uOiBuZXcgRmxvYXQzMkFycmF5KGNvbFBvaW50cylcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGJ1ZmZlckluZm8gPSBjcmVhdGVCdWZmZXJzRm9yQXR0cmlidXRlcyhnbCwgcHJvZ3JhbSwgYXJyYXlzKTtcclxuICAgICAgICBzZXRVbmlmb3JtcyhzZXR0ZXJzLCB7XHJcbiAgICAgICAgICAgIHVfbWF0cml4OiBuZXcgTWF0aFV0aWxzKCkuZ2V0VHJhbnNmb3JtYXRpb25NYXRyaXgoZ2wpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoYnVmZmVySW5mby5hX3Bvc2l0aW9uLmxvY2F0aW9uKTtcclxuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVySW5mby5hX3Bvc2l0aW9uLmJ1ZmZlcik7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBDT0xfTlVNUzsgaSsrKSB7XHJcbiAgICAgICAgICAgIHNldFVuaWZvcm1zKHNldHRlcnMsIHtcclxuICAgICAgICAgICAgICAgIHVfY29sb3I6IFtNYXRoLnJhbmRvbSgpLCBNYXRoLnJhbmRvbSgpLCBNYXRoLnJhbmRvbSgpLCAxXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihidWZmZXJJbmZvLmFfcG9zaXRpb24ubG9jYXRpb24sIDIsIGdsLkZMT0FULCBmYWxzZSwgMCwgaSAqIDEyICogRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UKTtcclxuICAgICAgICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRVMsIDAsIDEyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGlja0luZm8obGFyZ2VzdDogbnVtYmVyLCBtb3N0VGlja3M6IG51bWJlcik6IFRpY2tJbmZvIHtcclxuICAgICAgICBjb25zdCBtaW5pbXVtID0gbGFyZ2VzdCAvIG1vc3RUaWNrcztcclxuICAgICAgICBjb25zdCBtYWduaXR1ZGUgPSBNYXRoLnBvdygxMCwgTWF0aC5mbG9vcihNYXRoLmxvZzEwKG1pbmltdW0pKSk7XHJcbiAgICAgICAgY29uc3QgcmVzaWR1YWwgPSBtaW5pbXVtIC8gbWFnbml0dWRlO1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gWzEsIDEuNSwgMiwgMywgNSwgNywgMTBdO1xyXG4gICAgICAgIGNvbnN0IHRpY2sgPSByZXNpZHVhbCA8IDEwID8gdGFibGUuZmluZCgoZSkgPT4gKGUgPiByZXNpZHVhbCkpIDogMTA7XHJcbiAgICAgICAgY29uc3QgdGlja0hlaWdodCA9IHRpY2sgKiBtYWduaXR1ZGU7XHJcbiAgICAgICAgY29uc3QgdGlja0NvdW50ID0gTWF0aC5jZWlsKGxhcmdlc3QgLyB0aWNrSGVpZ2h0KTtcclxuICAgICAgICByZXR1cm4geyB0aWNrSGVpZ2h0LCB0aWNrQ291bnQgfTtcclxuICAgIH1cclxufVxyXG5cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3Mge1xyXG4gICAgLyoqXHJcbiAgICAgKiBJZiBuZWVkZWQsIHNsaWNlICdhcnJheScgdG8gJ2xlbicgaXRlbXMgb3IgZmlsbCB0byAnbGVuJyBpdGVtcyB1c2luZyAnZmlsbFdpdGgnLlxyXG4gICAgICogQHBhcmFtIGFycmF5IC0gYXJyYXkgdG8gc2xpY2Ugb3IgZmlsbC5cclxuICAgICAqIEBwYXJhbSBsZW4gLSB0aGUgcmVzdWx0aW5nIGxlbmd0aCBvZiBhcnJheS5cclxuICAgICAqIEBwYXJhbSBmaWxsV2l0aCAtIG51bWJlciB3aXRoIHdoaWNoIGFycmF5IHNob3VsZCBiZSBmaWxsZWQuXHJcbiAgICAgKiBAcmV0dXJucyBzbGljZWQgb3IgZmlsbGVkIGFycmF5LlxyXG4gICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgc2xpY2VPckZpbGwoYXJyYXk6IG51bWJlcltdLCBsZW46IG51bWJlciwgZmlsbFdpdGg/OiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gbGVuKSByZXR1cm4gYXJyYXk7XHJcbiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IGxlbikgcmV0dXJuIGFycmF5LnNsaWNlKDAsIGxlbik7XHJcbiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA8IGxlbilcclxuICAgICAgICAgICAgd2hpbGUgKGFycmF5Lmxlbmd0aCAhPT0gbGVuKVxyXG4gICAgICAgICAgICAgICAgYXJyYXkucHVzaChmaWxsV2l0aCA/PyAwKTtcclxuICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNZXJnZSBwcm9wZXJ0aWVzIGZyb20gJ25ld09wdGlvbnMnIHRvICdhY3R1YWxPcHRpb25zJyAocmlnaHQtam9pbiBsaWtlKS5cclxuICAgICAqIEBwYXJhbSBuZXdPcHRpb25zIC0gc29tZSBvcHRpb24gcHJvcGVydGllcyBmb3IgdHlwZSBULlxyXG4gICAgICogQHBhcmFtIGFjdHVhbE9wdGlvbnMgLSBhbGwgb3B0aW9uIHByb3BlcnRpZXMgZm9yIHR5cGUgVC5cclxuICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIG1lcmdlUmlnaHQ8VD4obmV3T3B0aW9uczogUGFydGlhbDxUPiwgYWN0dWFsT3B0aW9uczogVCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhhY3R1YWxPcHRpb25zKTtcclxuICAgICAgICBPYmplY3QuZW50cmllcyhuZXdPcHRpb25zKS5mb3JFYWNoKHBhaXIgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBwYWlyWzBdO1xyXG4gICAgICAgICAgICBpZiAoa2V5cy5pbmNsdWRlcyhrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhaXJbMV07XHJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50IFxyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgYWN0dWFsT3B0aW9uc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFNlcmllRGF0YUNvbW1vbiwgQ2hhcnRPcHRpb25zLCBDb250ZXh0U291cmNlLCBTZXJpZU9wdGlvbnMgfSBmcm9tIFwiLi4vbW9kZWxzXCI7XHJcbmltcG9ydCBDaGFydERyYWZ0c21hbiBmcm9tIFwiLi4vcGxvdC1sb2dpYy9DaGFydERyYWZ0c21hblwiO1xyXG5pbXBvcnQgQ2hhcnRVdGlscyBmcm9tIFwiLi9DaGFydFV0aWxzXCI7XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ2hhcnQge1xyXG5cclxuICAgIGNvbnRleHQ6IFdlYkdMUmVuZGVyaW5nQ29udGV4dDtcclxuICAgIHNlcmllc0RhdGE6IFNlcmllRGF0YUNvbW1vbltdO1xyXG4gICAgY2hhcnRPcHRpb25zOiBDaGFydE9wdGlvbnM7XHJcbiAgICBjaGFydERyYWZ0c21hbjogQ2hhcnREcmFmdHNtYW47XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc291cmNlOiBDb250ZXh0U291cmNlKSB7XHJcbiAgICAgICAgbGV0IGFuYWx5emVkRWxlbWVudCA9IHNvdXJjZTtcclxuICAgICAgICBpZiAodHlwZW9mIGFuYWx5emVkRWxlbWVudCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgYW5hbHl6ZWRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYW5hbHl6ZWRFbGVtZW50LnJlcGxhY2UoJy9eIy8nLCAnJykpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYW5hbHl6ZWRFbGVtZW50IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gYW5hbHl6ZWRFbGVtZW50LmdldENvbnRleHQoJ3dlYmdsJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGFuYWx5emVkRWxlbWVudCBpbnN0YW5jZW9mIFdlYkdMUmVuZGVyaW5nQ29udGV4dCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBhbmFseXplZEVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgdGhyb3cgRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgdmFsaWQgSUQsIEhUTUxDYW52YXNFbGVtZW50IG9yIFdlYkdMUmVuZGVyaW5nQ29udGV4dCcpO1xyXG5cclxuICAgICAgICB0aGlzLmNoYXJ0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgdGl0bGU6ICdVbnRpdGxlZCcsXHJcbiAgICAgICAgICAgIHNob3dUaXRsZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2hvd0xlZ2VuZDogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlcmllc0RhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5jaGFydERyYWZ0c21hbiA9IG5ldyBDaGFydERyYWZ0c21hbih0aGlzLmNvbnRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXRDaGFydE9wdGlvbnMob3B0aW9uczogUGFydGlhbDxDaGFydE9wdGlvbnM+KTogdm9pZCB7XHJcbiAgICAgICAgQ2hhcnRVdGlscy5tZXJnZVJpZ2h0KG9wdGlvbnMsIHRoaXMuY2hhcnRPcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0U2VyaWVPcHRpb25zKG5ld09wdGlvbnM6IFBhcnRpYWw8U2VyaWVPcHRpb25zPiwgd2hpY2hTZXJpZXM/OiBzdHJpbmdbXSk6IHZvaWQge1xyXG4gICAgICAgIGlmICh3aGljaFNlcmllcykgd2hpY2hTZXJpZXMuZm9yRWFjaCgoc2VyaWVOYW1lKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGFjdHVhbFNlcmllID1cclxuICAgICAgICAgICAgICAgIHRoaXMuc2VyaWVzRGF0YS5maW5kKChleGlzdGluZ1NlcmllKSA9PiBleGlzdGluZ1NlcmllLm5hbWUgPT0gc2VyaWVOYW1lKTtcclxuICAgICAgICAgICAgaWYgKGFjdHVhbFNlcmllKSB7XHJcbiAgICAgICAgICAgICAgICBDaGFydFV0aWxzLm1lcmdlUmlnaHQobmV3T3B0aW9ucywgYWN0dWFsU2VyaWUub3B0aW9ucyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFNlcmllIHdpdGggbmFtZSAke3NlcmllTmFtZX0gbm90IGZvdW5kLmApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZWxzZSB0aGlzLnNlcmllc0RhdGEuZm9yRWFjaCgoc2VyaWUpID0+IENoYXJ0VXRpbHMubWVyZ2VSaWdodChuZXdPcHRpb25zLCBzZXJpZS5vcHRpb25zKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFic3RyYWN0IHNldCBYKHZhbHVlOiBzdHJpbmdbXSB8IG51bWJlcltdIHwgbnVtYmVyW11bXSk7XHJcbiAgICBwdWJsaWMgYWJzdHJhY3Qgc2V0IFkodmFsdWU6IG51bWJlcltdIHwgbnVtYmVyW11bXSk7XHJcbiAgICBwdWJsaWMgYWJzdHJhY3QgZHJhdygpOiB2b2lkO1xyXG59IiwiaW1wb3J0IHsgTXVsdGlTZXJpZURhdGEsIENvbnRleHRTb3VyY2UgfSBmcm9tIFwiLi4vbW9kZWxzXCI7XHJcbmltcG9ydCB7IENoYXJ0IH0gZnJvbSBcIi4vQ2hhcnRcIjtcclxuaW1wb3J0IENoYXJ0VXRpbHMgZnJvbSBcIi4vQ2hhcnRVdGlsc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEJhckNoYXJ0IGV4dGVuZHMgQ2hhcnQge1xyXG4gICAgZGF0YUxhYmVsczogc3RyaW5nW107XHJcbiAgICBzZXJpZXNEYXRhOiBNdWx0aVNlcmllRGF0YVtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHNvdXJjZTogQ29udGV4dFNvdXJjZSkge1xyXG4gICAgICAgIHN1cGVyKHNvdXJjZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBYKGxhYmVsczogc3RyaW5nW10pIHtcclxuICAgICAgICB0aGlzLmRhdGFMYWJlbHMgPSBsYWJlbHM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBZKHNlcmllczogbnVtYmVyW11bXSkge1xyXG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzLmRhdGFMYWJlbHM7XHJcbiAgICAgICAgaWYgKCFsZW5ndGgpXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdWYWx1ZXMgb24gXCJYXCIgYXhpcyBtdXN0IGJlIHNwZWNpZmllZCBiZWZvcmUgc2V0dGluZyBcIllcIiB2YWx1ZXMuJyk7XHJcbiAgICAgICAgY29uc3QgbWFwcGVkU2VyaWVzID0gc2VyaWVzLm1hcChzZXJpZSA9PiBDaGFydFV0aWxzLnNsaWNlT3JGaWxsKHNlcmllLCBsZW5ndGgpKTtcclxuICAgICAgICB0aGlzLnNlcmllc0RhdGEgPSBtYXBwZWRTZXJpZXMubWFwKChzZXJpZSwgaW5kZXgpID0+IHRoaXMuZ2V0RGVmYXVsdFNlcmllT2JqZWN0KHNlcmllLCBpbmRleCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdFNlcmllT2JqZWN0KHNlcmllOiBudW1iZXJbXSwgaW5kZXg6IG51bWJlcik6IE11bHRpU2VyaWVEYXRhIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB2YWx1ZXM6IHNlcmllLFxyXG4gICAgICAgICAgICBuYW1lOiBgc2VyaWUke2luZGV4fWAsXHJcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU1KSxcclxuICAgICAgICAgICAgICAgICAgICBnOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpLFxyXG4gICAgICAgICAgICAgICAgICAgIGI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSksXHJcbiAgICAgICAgICAgICAgICAgICAgYTogMjU1XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2hvd0xhYmVsczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaG93T25MZWdlbmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZWRnZVRoaWNrbmVzczogMCxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5jaGFydERyYWZ0c21hbi5kcmF3TGluZXModGhpcy5zZXJpZXNEYXRhWzBdLnZhbHVlcyk7XHJcbiAgICAgICAgdGhpcy5jaGFydERyYWZ0c21hbi5kcmF3QmFycyh0aGlzLnNlcmllc0RhdGFbMF0udmFsdWVzKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFNpbmdsZVNlcmllRGF0YSwgQ29udGV4dFNvdXJjZSB9IGZyb20gXCIuLi9tb2RlbHNcIjtcclxuaW1wb3J0IHsgQ2hhcnQgfSBmcm9tIFwiLi9DaGFydFwiO1xyXG5pbXBvcnQgQ2hhcnRVdGlscyBmcm9tIFwiLi9DaGFydFV0aWxzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUGllQ2hhcnQgZXh0ZW5kcyBDaGFydCB7XHJcblxyXG4gICAgc2VyaWVzRGF0YTogU2luZ2xlU2VyaWVEYXRhW107XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc291cmNlOiBDb250ZXh0U291cmNlKSB7XHJcbiAgICAgICAgc3VwZXIoc291cmNlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IFgobGFiZWxzOiBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuc2VyaWVzRGF0YSA9XHJcbiAgICAgICAgICAgIGxhYmVscy5tYXAoKGxhYmVsKSA9PiB0aGlzLmdldERlZmF1bHRTZXJpZU9iamVjdChsYWJlbCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgWSh2YWx1ZXM6IG51bWJlcltdKSB7XHJcbiAgICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHRoaXMuc2VyaWVzRGF0YTtcclxuICAgICAgICBpZiAoIWxlbmd0aClcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1ZhbHVlcyBvbiBcIlhcIiBheGlzIG11c3QgYmUgc3BlY2lmaWVkIGJlZm9yZSBzZXR0aW5nIFwiWVwiIHZhbHVlcy4nKTtcclxuICAgICAgICBjb25zdCBtYXBwZWRWYWx1ZXMgPSBDaGFydFV0aWxzLnNsaWNlT3JGaWxsKHZhbHVlcywgbGVuZ3RoKTtcclxuICAgICAgICB0aGlzLnNlcmllc0RhdGEubWFwKChvcHRpb24sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IG1hcHBlZFZhbHVlc1tpbmRleF07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREZWZhdWx0U2VyaWVPYmplY3QobGFiZWw6IHN0cmluZyk6IFNpbmdsZVNlcmllRGF0YSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWU6IDAsXHJcbiAgICAgICAgICAgIG5hbWU6IGxhYmVsLFxyXG4gICAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHI6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSksXHJcbiAgICAgICAgICAgICAgICAgICAgZzogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU1KSxcclxuICAgICAgICAgICAgICAgICAgICBiOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpLFxyXG4gICAgICAgICAgICAgICAgICAgIGE6IDI1NVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNob3dMYWJlbHM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2hvd09uTGVnZW5kOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGVkZ2VUaGlja25lc3M6IDAsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KCk6IHZvaWQge1xyXG4gICAgICAgIHRocm93IEVycm9yKFwiTm90IGltcGxlbWVudGVkIHlldFwiKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IENvbnRleHRTb3VyY2UgfSBmcm9tIFwiLi4vbW9kZWxzXCI7XHJcbmltcG9ydCB7IEJhckNoYXJ0IH0gZnJvbSBcIi4vQmFyQ2hhcnRcIjtcclxuaW1wb3J0IHsgQ2hhcnQgfSBmcm9tIFwiLi9DaGFydFwiO1xyXG5pbXBvcnQgeyBQaWVDaGFydCB9IGZyb20gXCIuL1BpZUNoYXJ0XCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzZXJ2ZUNoYXJ0KHR5cGU6IHN0cmluZywgc291cmNlOiBDb250ZXh0U291cmNlKTogQ2hhcnQge1xyXG4gICAgc3dpdGNoICh0eXBlLnRvTG93ZXJDYXNlKCkudHJpbSgpKSB7XHJcbiAgICAgICAgY2FzZSBcInBpZVwiOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFBpZUNoYXJ0KHNvdXJjZSk7XHJcbiAgICAgICAgY2FzZSBcImJhclwiOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEJhckNoYXJ0KHNvdXJjZSk7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3R5cGV9IGNoYXJ0IGlzIG5vdCBkZWZpbmVkLmApO1xyXG4gICAgfVxyXG59Il0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJleHBvcnRzIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiY3JlYXRlUHJvZ3JhbSIsImdsIiwidnMiLCJmcyIsInByb2dyYW0iLCJ2c08iLCJmc08iLCJhdHRhY2hTaGFkZXIiLCJsaW5rUHJvZ3JhbSIsImdldFByb2dyYW1QYXJhbWV0ZXIiLCJMSU5LX1NUQVRVUyIsImxvZyIsImdldFByb2dyYW1JbmZvTG9nIiwiZGVsZXRlUHJvZ3JhbSIsIkVycm9yIiwiY3JlYXRlUHJvZ3JhbUZyb21TaGFkZXJzIiwiY3JlYXRlU2hhZGVyIiwiVkVSVEVYX1NIQURFUiIsIkZSQUdNRU5UX1NIQURFUiIsInR5cGUiLCJzb3VyY2UiLCJzaGFkZXIiLCJzaGFkZXJTb3VyY2UiLCJjb21waWxlU2hhZGVyIiwiZ2V0U2hhZGVyUGFyYW1ldGVyIiwiQ09NUElMRV9TVEFUVVMiLCJnZXRTaGFkZXJJbmZvTG9nIiwiZGVsZXRlU2hhZGVyIiwiaXNCdWlsdEluIiwibmFtZSIsInN0YXJ0c1dpdGgiLCJnZXRVbmlmb3JtU2V0dGVyQnlUeXBlIiwibG9jIiwiRkxPQVQiLCJkYXRhIiwidW5pZm9ybTFmdiIsIkZMT0FUX1ZFQzIiLCJ1bmlmb3JtMmZ2IiwiRkxPQVRfVkVDMyIsInVuaWZvcm0zZnYiLCJGTE9BVF9WRUM0IiwidW5pZm9ybTRmdiIsIklOVCIsInVuaWZvcm0xaXYiLCJJTlRfVkVDMiIsInVuaWZvcm0yaXYiLCJJTlRfVkVDMyIsInVuaWZvcm0zaXYiLCJJTlRfVkVDNCIsInVuaWZvcm00aXYiLCJGTE9BVF9NQVQyIiwidW5pZm9ybU1hdHJpeDJmdiIsIkZMT0FUX01BVDMiLCJ1bmlmb3JtTWF0cml4M2Z2IiwiRkxPQVRfTUFUNCIsInVuaWZvcm1NYXRyaXg0ZnYiLCJjcmVhdGVVbmlmb3JtU2V0dGVycyIsIm51bVVuaWZvcm1zIiwiQUNUSVZFX1VOSUZPUk1TIiwidW5pZm9ybVNldHRlcnMiLCJpIiwidW5pZm9ybUluZm8iLCJnZXRBY3RpdmVVbmlmb3JtIiwibG9jYXRpb24iLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJzZXR0ZXIiLCJlbmRzV2l0aCIsInN1YnN0ciIsImxlbmd0aCIsInNldFVuaWZvcm1zIiwic2V0dGVycyIsIml0ZW0iLCJjcmVhdGVCdWZmZXJzRm9yQXR0cmlidXRlcyIsImJ1ZmZlckluZm8iLCJhdHRyaWIiLCJnZXRBdHRyaWJMb2NhdGlvbiIsImJ1ZmZlciIsImNyZWF0ZUJ1ZmZlciIsImJpbmRCdWZmZXIiLCJBUlJBWV9CVUZGRVIiLCJidWZmZXJEYXRhIiwiU1RBVElDX0RSQVciLCJieXRlTGVuZ3RoIiwiTWF0aFV0aWxzIiwiaWRlbnRpdHlNYXRyaXgiLCJwcm9qZWN0aW9uTWF0cml4Iiwid2lkdGgiLCJoZWlnaHQiLCJ0cmFuc2xhdGlvbk1hdHJpeCIsInR4IiwidHkiLCJyb3RhdGlvbk1hdHJpeCIsImRlZ3JlZXMiLCJyYWRpYW5zIiwiTWF0aCIsIlBJIiwicyIsInNpbiIsImMiLCJjb3MiLCJzY2FsZU1hdHJpeCIsInN4Iiwic3kiLCJhcnJheVRvTWF0cml4IiwiYXJyIiwic2l6ZSIsInJlcyIsInB1c2giLCJzbGljZSIsIm11bHRpcGx5TWF0cmljZXMiLCJGIiwiUyIsImluY2x1ZGVzIiwicG93Iiwic3FydCIsIkEiLCJ0aGlzIiwiQiIsIm1hcCIsInJvdyIsIl8iLCJqIiwicmVkdWNlIiwiYWNjIiwibiIsImZsYXQiLCJnZXRUcmFuc2Zvcm1hdGlvbk1hdHJpeCIsImNhbnZhcyIsIm1hdHJpeCIsIkNoYXJ0RHJhZnRzbWFuIiwiY29uc3RydWN0b3IiLCJkcmF3TGluZXMiLCJzZXJpZXMiLCJtYXgiLCJhYnMiLCJ0aWNrSW5mbyIsImdldFRpY2tJbmZvIiwidyIsImgiLCJwYWRkaW5nIiwiZmxvb3IiLCJtaW4iLCJ1bmRlckxpbmVBcmVhSGVpZ2h0IiwibGluZXNQb2ludHMiLCJzdGFydCIsImVuZCIsInRpY2tDb3VudCIsImxpbmVIIiwidW5pZm9ybXMiLCJ1X2NvbG9yIiwidV9tYXRyaXgiLCJhcnJheXMiLCJhX3Bvc2l0aW9uIiwiSW50MTZBcnJheSIsInVzZVByb2dyYW0iLCJidWZmZXJzIiwidmlld3BvcnQiLCJjbGVhckNvbG9yIiwiY2xlYXIiLCJDT0xPUl9CVUZGRVJfQklUIiwicHJlcGFyZVZpZXciLCJlbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSIsInZlcnRleEF0dHJpYlBvaW50ZXIiLCJTSE9SVCIsImRyYXdBcnJheXMiLCJMSU5FUyIsImRyYXdCYXJzIiwiVyIsIm11bHRpcGllciIsImNvbFBvaW50cyIsIkNPTF9OVU1TIiwiY29sQXJlYVdpZHRoIiwiY29sSGVpZ2h0IiwicG9pbnRMZWZ0WCIsInBvaW50TGVmdFkiLCJGbG9hdDMyQXJyYXkiLCJyYW5kb20iLCJCWVRFU19QRVJfRUxFTUVOVCIsIlRSSUFOR0xFUyIsImxhcmdlc3QiLCJtb3N0VGlja3MiLCJtaW5pbXVtIiwibWFnbml0dWRlIiwibG9nMTAiLCJyZXNpZHVhbCIsInRpY2tIZWlnaHQiLCJmaW5kIiwiZSIsImNlaWwiLCJzdGF0aWMiLCJhcnJheSIsImxlbiIsImZpbGxXaXRoIiwibmV3T3B0aW9ucyIsImFjdHVhbE9wdGlvbnMiLCJrZXlzIiwiZW50cmllcyIsImZvckVhY2giLCJwYWlyIiwidmFsdWUiLCJDaGFydCIsImFuYWx5emVkRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZXBsYWNlIiwiSFRNTENhbnZhc0VsZW1lbnQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsIldlYkdMUmVuZGVyaW5nQ29udGV4dCIsImNoYXJ0T3B0aW9ucyIsInRpdGxlIiwic2hvd1RpdGxlIiwic2hvd0xlZ2VuZCIsInNlcmllc0RhdGEiLCJjaGFydERyYWZ0c21hbiIsInNldENoYXJ0T3B0aW9ucyIsIm9wdGlvbnMiLCJDaGFydFV0aWxzIiwibWVyZ2VSaWdodCIsInNldFNlcmllT3B0aW9ucyIsIndoaWNoU2VyaWVzIiwic2VyaWVOYW1lIiwiYWN0dWFsU2VyaWUiLCJleGlzdGluZ1NlcmllIiwiY29uc29sZSIsIndhcm4iLCJzZXJpZSIsIkJhckNoYXJ0Iiwic3VwZXIiLCJYIiwibGFiZWxzIiwiZGF0YUxhYmVscyIsIlkiLCJtYXBwZWRTZXJpZXMiLCJzbGljZU9yRmlsbCIsImluZGV4IiwiZ2V0RGVmYXVsdFNlcmllT2JqZWN0IiwidmFsdWVzIiwiY29sb3IiLCJyIiwiZyIsImIiLCJhIiwic2hvd0xhYmVscyIsInNob3dPbkxlZ2VuZCIsImVkZ2VUaGlja25lc3MiLCJkcmF3IiwiUGllQ2hhcnQiLCJsYWJlbCIsIm1hcHBlZFZhbHVlcyIsIm9wdGlvbiIsInNlcnZlQ2hhcnQiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iXSwic291cmNlUm9vdCI6IiJ9