var t={d:(e,s)=>{for(var r in s)t.o(s,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:s[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{Z:()=>l});class s{constructor(t){this.ctx=t}strokeFrameForTest(t,e){this.ctx.strokeStyle=e,this.ctx.strokeRect(t.x,t.y,t.w,t.h),this.ctx.strokeStyle="black"}getContentFrame(){const{width:t,height:e}=this.ctx.canvas,s=Math.floor(Math.min(t,e)/100);return{x:s,y:s,w:t-2*s,h:e-2*s}}getTitleFrame(t){const e=Math.floor(t.h/10);return{x:t.x,y:t.y,h:e,w:t.w}}getRemainingContentFrame(t,e){return{x:t.x,y:t.y<e.y?t.y:e.y+e.h,w:t.w,h:t.h-e.h}}getLegendFrame(t){const e=Math.floor(t.h/10);return{x:t.x,y:t.y+t.h-e,h:e,w:t.w}}drawTitle(t,e){const{ctx:s}=this,r=this.getTitleFrame(e),{x:o,y:i,w:n,h:a}=r;s.font=`${Math.floor(a/2)}px sans-serif`;const h=s.measureText(t),l=o+n/2-h.width/2,c=i+a/2+h.actualBoundingBoxAscent/2;return s.fillText(t,l,c,n),this.strokeFrameForTest(r,"red"),this.getRemainingContentFrame(e,r)}drawLegend(t){const e=this.getLegendFrame(t);return this.strokeFrameForTest(e,"green"),this.getRemainingContentFrame(t,e)}prepareChartForDrawing(t){const{ctx:e}=this,{width:s,height:r}=e.canvas;this.ctx.clearRect(0,0,s,r);let o=this.getContentFrame();return this.strokeFrameForTest(o,"blue"),t.showTitle&&t.title&&(o=this.drawTitle(t.title,o)),t.showLegend&&(o=this.drawLegend(o)),this.strokeFrameForTest(o,"yellow"),o}drawGridHorizontalLines(t,e){const{ctx:s}=this,r=function(t,e){const s=t/10,r=Math.pow(10,Math.floor(Math.log10(s))),o=s/r,i=(o<10?[1,1.5,2,3,5,7,10].find((t=>t>o)):10)*r;return{tickHeight:i,tickCount:Math.ceil(t/i)}}(Math.max(...t.map((t=>Math.max(...t.values))))),o=e.h/r.tickCount+1;s.lineWidth=3,s.strokeStyle="gray";for(let t=1;t<=r.tickCount;t++){const r=e.y+o*t;s.beginPath(),s.moveTo(e.x,r),s.lineTo(e.x+e.w,r),s.stroke(),s.closePath()}return r}}const r=class{static sliceOrFill(t,e,s){if(t.length===e)return t;if(t.length>e)return t.slice(0,e);if(t.length<e)for(;t.length!==e;)t.push(null!=s?s:0);return t}static mergeRight(t,e){const s=Object.keys(e);Object.entries(t).forEach((t=>{const r=t[0];if(s.includes(r)){const s=t[1];e[r]=s}}))}};class o{constructor(t){let e=t;if("string"==typeof e&&(e=document.getElementById(e.replace("/^#/",""))),e instanceof HTMLCanvasElement)this.context=e.getContext("2d");else{if(!(e instanceof CanvasRenderingContext2D))throw Error("Argument must be valid ID, HTMLCanvasElement or CanvasRenderingContext2D");this.context=e}this.chartOptions={title:"Untitled",showTitle:!0,showLegend:!1},this.seriesData=[],this.plot=new s(this.context)}setChartOptions(t){r.mergeRight(t,this.chartOptions)}setSerieOptions(t,e){e?e.forEach((e=>{const s=this.seriesData.find((t=>t.name==e));s?r.mergeRight(t,s.options):console.warn(`Serie with name ${e} not found.`)})):this.seriesData.forEach((e=>r.mergeRight(t,e.options)))}}class i extends s{constructor(t){super(t.ctx)}drawBar(t,e,s,r,o){console.log(o),this.ctx.fillStyle=o,this.ctx.lineWidth=1,this.ctx.fillRect(t,e,s,r)}drawBars(t,e){const{ctx:s}=this,r=this.prepareChartForDrawing(e),o=this.drawGridHorizontalLines(t,r),i=t.length,n=r.w/i,a=.75*n,h=(n-a)/2,l=t[0].values.length,c=a/l*.75;for(let e=0;e<l;e++)for(let s=0;s<i;s++){const i=t[s].values[e]*r.h/o.tickCount+1;this.drawBar(r.x+s*n+h+e*c,r.y+r.h-i,c,i,t[e].options.color)}}}class n extends o{constructor(t){super(t),this.plot=new i(this.plot)}set X(t){this.dataLabels=t}set Y(t){const{length:e}=this.dataLabels;if(!e)throw Error('Values on "X" axis must be specified before setting "Y" values.');const s=t.map((t=>r.sliceOrFill(t,e)));this.seriesData=s.map(((t,e)=>this.getDefaultSerieObject(t,e)))}getDefaultSerieObject(t,e){return{values:t,name:`serie${e}`,options:{color:Math.floor(16777215*Math.random()).toString(16),showLabels:!1,showOnLegend:!1,edgeThickness:0}}}draw(){this.plot.drawBars(this.seriesData,this.chartOptions)}}class a extends s{constructor(t){super(t.ctx)}drawPie(t,e){const{ctx:s}=this,r=this.prepareChartForDrawing(e),o=this.mapSeriesToPieDegAndColor(t),i=Math.min(r.w,r.h)/2.5,n={x:r.x+r.w/2,y:r.y+r.h/2};let a=0;o.forEach((t=>{s.fillStyle=t.color,s.beginPath(),s.moveTo(n.x,n.y),s.arc(n.x,n.y,i,a,a+=t.rad),s.lineTo(n.x,n.y),s.fill()})),a=0,o.forEach((t=>{t.thickness>0?(s.strokeStyle="black",s.lineWidth=t.thickness,s.beginPath(),s.moveTo(n.x,n.y),s.arc(n.x,n.y,i,a,a+=t.rad),s.lineTo(n.x,n.y),s.stroke()):a+=t.rad}))}mapSeriesToPieDegAndColor(t){const e=t.map((t=>t.value)).reduce(((t,e)=>t+e),0);return t.map((t=>({rad:2*t.value*Math.PI/e,color:t.options.color,thickness:t.options.edgeThickness})))}}class h extends o{constructor(t){super(t),this.plot=new a(this.plot)}set X(t){this.seriesData=t.map((t=>this.getDefaultSerieObject(t)))}set Y(t){const{length:e}=this.seriesData;if(!e)throw Error('Values on "X" axis must be specified before setting "Y" values.');const s=r.sliceOrFill(t,e);this.seriesData.map(((t,e)=>{t.value=s[e]}))}getDefaultSerieObject(t){return{value:0,name:t,options:{color:Math.floor(16777215*Math.random()).toString(16),showLabels:!1,showOnLegend:!1,edgeThickness:0}}}draw(){this.plot.drawPie(this.seriesData,this.chartOptions)}}function l(t,e){switch(t.toLowerCase().trim()){case"pie":return new h(e);case"bar":return new n(e);default:throw new Error(`${t} chart is not defined.`)}}var c=e.Z;export{c as default};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVFhLEdBQ3BEMUUsS0FBS2dHLFdBQVdyQyxLQUFJLENBQUNvRyxFQUFRM0IsS0FDekIyQixFQUFPM0UsTUFBUTBFLEVBQWExQixNQUk1QkMsc0JBQXNCd0IsR0FDMUIsTUFBTyxDQUNIekUsTUFBTyxFQUNQcUIsS0FBTW9ELEVBQ04xRCxRQUFTLENBQ0xoRyxNQUFPWSxLQUFLQyxNQUFzQixTQUFoQkQsS0FBS3VILFVBQXFCQyxTQUFTLElBQ3JEQyxZQUFZLEVBQ1pDLGNBQWMsRUFDZEMsY0FBZSxJQUtwQkMsT0FDSDNJLEtBQUtpRyxLQUFLNEMsUUFBUTdJLEtBQUtnRyxXQUFZaEcsS0FBS3NDLGVDdkNqQyxTQUFTMEgsRUFBV0MsRUFBYzNFLEdBQzdDLE9BQVEyRSxFQUFLQyxjQUFjQyxRQUN2QixJQUFLLE1BQ0QsT0FBTyxJQUFJUCxFQUFTdEUsR0FDeEIsSUFBSyxNQUNELE9BQU8sSUFBSXdDLEVBQVN4QyxHQUN4QixRQUNJLE1BQU0sSUFBSVMsTUFBTSxHQUFHa0UsNEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL3Bsb3QvUGxvdFNrZWxldG9uLnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvcGxvdC91dGlscy50cyIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL21vZGVsL3V0aWxzLnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvbW9kZWwvQ2hhcnQudHMiLCJ3ZWJwYWNrOi8vQGJyei93ZWJnbC1jaGFydC8uL3NyYy9wbG90L0JhclBsb3QudHMiLCJ3ZWJwYWNrOi8vQGJyei93ZWJnbC1jaGFydC8uL3NyYy9tb2RlbC9CYXJDaGFydC50cyIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL3Bsb3QvUGllUGxvdC50cyIsIndlYnBhY2s6Ly9AYnJ6L3dlYmdsLWNoYXJ0Ly4vc3JjL21vZGVsL1BpZUNoYXJ0LnRzIiwid2VicGFjazovL0Bicnovd2ViZ2wtY2hhcnQvLi9zcmMvaW50ZXJmYWNlL0NoYXJ0U2VydmFudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImltcG9ydCB7IENoYXJ0T3B0aW9ucywgTXVsdGlTZXJpZURhdGEgfSBmcm9tIFwiLi4vbW9kZWwvdHlwZXNcIjtcclxuaW1wb3J0IHsgRnJhbWVSZWN0LCBUaWNrSW5mbyB9IGZyb20gXCIuL3R5cGVzXCI7XHJcbmltcG9ydCB7IGdldFRpY2tJbmZvIH0gZnJvbSBcIi4vdXRpbHNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBsb3RTa2VsZXRvbiB7XHJcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xyXG4gICAgICAgIHRoaXMuY3R4ID0gY3R4O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc3Ryb2tlRnJhbWVGb3JUZXN0KGZyYW1lOiBGcmFtZVJlY3QsIGNvbG9yOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xyXG4gICAgICAgIHRoaXMuY3R4LnN0cm9rZVJlY3QoZnJhbWUueCwgZnJhbWUueSwgZnJhbWUudywgZnJhbWUuaCk7XHJcbiAgICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q29udGVudEZyYW1lKCk6IEZyYW1lUmVjdCB7XHJcbiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLmN0eC5jYW52YXM7XHJcbiAgICAgICAgY29uc3QgcGFkZGluZyA9IE1hdGguZmxvb3IoTWF0aC5taW4od2lkdGgsIGhlaWdodCkgLyAxMDApO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHg6IHBhZGRpbmcsXHJcbiAgICAgICAgICAgIHk6IHBhZGRpbmcsXHJcbiAgICAgICAgICAgIHc6IHdpZHRoIC0gMiAqIHBhZGRpbmcsXHJcbiAgICAgICAgICAgIGg6IGhlaWdodCAtIDIgKiBwYWRkaW5nLFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRUaXRsZUZyYW1lKGNvbnRlbnRGcmFtZTogRnJhbWVSZWN0KTogRnJhbWVSZWN0IHtcclxuICAgICAgICBjb25zdCBGUkFNRV9IRUlHSFRfRElWSURFUiA9IDEwO1xyXG4gICAgICAgIGNvbnN0IG5ld0ggPSBNYXRoLmZsb29yKGNvbnRlbnRGcmFtZS5oIC8gRlJBTUVfSEVJR0hUX0RJVklERVIpO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHg6IGNvbnRlbnRGcmFtZS54LFxyXG4gICAgICAgICAgICB5OiBjb250ZW50RnJhbWUueSxcclxuICAgICAgICAgICAgaDogbmV3SCxcclxuICAgICAgICAgICAgdzogY29udGVudEZyYW1lLndcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UmVtYWluaW5nQ29udGVudEZyYW1lKHByZXY6IEZyYW1lUmVjdCwgcmVjZW50OiBGcmFtZVJlY3QpOiBGcmFtZVJlY3Qge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHg6IHByZXYueCxcclxuICAgICAgICAgICAgeTogcHJldi55IDwgcmVjZW50LnkgPyBwcmV2LnkgOiByZWNlbnQueSArIHJlY2VudC5oLFxyXG4gICAgICAgICAgICB3OiBwcmV2LncsXHJcbiAgICAgICAgICAgIGg6IHByZXYuaCAtIHJlY2VudC5oXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldExlZ2VuZEZyYW1lKGZyYW1lOiBGcmFtZVJlY3QpOiBGcmFtZVJlY3Qge1xyXG4gICAgICAgIGNvbnN0IEZSQU1FX0hFSUdIVF9ESVZJREVSID0gMTA7XHJcbiAgICAgICAgY29uc3QgbmV3SCA9IE1hdGguZmxvb3IoZnJhbWUuaCAvIEZSQU1FX0hFSUdIVF9ESVZJREVSKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB4OiBmcmFtZS54LFxyXG4gICAgICAgICAgICB5OiBmcmFtZS55ICsgZnJhbWUuaCAtIG5ld0gsXHJcbiAgICAgICAgICAgIGg6IG5ld0gsXHJcbiAgICAgICAgICAgIHc6IGZyYW1lLndcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZHJhd1RpdGxlKHRpdGxlOiBzdHJpbmcsIGNvbnRlbnRGcmFtZTogRnJhbWVSZWN0KTogRnJhbWVSZWN0IHtcclxuICAgICAgICBjb25zdCB7IGN0eCB9ID0gdGhpcztcclxuICAgICAgICBjb25zdCB0aXRsZUZyYW1lID0gdGhpcy5nZXRUaXRsZUZyYW1lKGNvbnRlbnRGcmFtZSk7XHJcbiAgICAgICAgY29uc3QgeyB4LCB5LCB3LCBoIH0gPSB0aXRsZUZyYW1lO1xyXG4gICAgICAgIGN0eC5mb250ID0gYCR7TWF0aC5mbG9vcihoIC8gMil9cHggc2Fucy1zZXJpZmA7XHJcbiAgICAgICAgY29uc3QgdGV4dE1lYXN1cmVtZW50ID0gY3R4Lm1lYXN1cmVUZXh0KHRpdGxlKTtcclxuICAgICAgICBjb25zdCB0ZXh0V2lkdGggPSB0ZXh0TWVhc3VyZW1lbnQud2lkdGg7XHJcbiAgICAgICAgY29uc3QgdGV4dEhlaWdodCA9IHRleHRNZWFzdXJlbWVudC5hY3R1YWxCb3VuZGluZ0JveEFzY2VudDtcclxuICAgICAgICBjb25zdCB0ZXh0UG9zaXRpb25YID0geCArIHcgLyAyIC0gdGV4dFdpZHRoIC8gMjtcclxuICAgICAgICBjb25zdCB0ZXh0UG9zaXRpb25ZID0geSArIGggLyAyICsgdGV4dEhlaWdodCAvIDI7XHJcbiAgICAgICAgY3R4LmZpbGxUZXh0KHRpdGxlLCB0ZXh0UG9zaXRpb25YLCB0ZXh0UG9zaXRpb25ZLCB3KTtcclxuICAgICAgICB0aGlzLnN0cm9rZUZyYW1lRm9yVGVzdCh0aXRsZUZyYW1lLCAncmVkJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVtYWluaW5nQ29udGVudEZyYW1lKGNvbnRlbnRGcmFtZSwgdGl0bGVGcmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3TGVnZW5kKGNvbnRlbnRGcmFtZTogRnJhbWVSZWN0KTogRnJhbWVSZWN0IHtcclxuICAgICAgICBjb25zdCBsZWdlbmRGcmFtZSA9IHRoaXMuZ2V0TGVnZW5kRnJhbWUoY29udGVudEZyYW1lKTtcclxuICAgICAgICB0aGlzLnN0cm9rZUZyYW1lRm9yVGVzdChsZWdlbmRGcmFtZSwgJ2dyZWVuJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVtYWluaW5nQ29udGVudEZyYW1lKGNvbnRlbnRGcmFtZSwgbGVnZW5kRnJhbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBwcmVwYXJlQ2hhcnRGb3JEcmF3aW5nKGNoYXJ0T3B0aW9uczogQ2hhcnRPcHRpb25zKTogRnJhbWVSZWN0IHtcclxuICAgICAgICBjb25zdCB7IGN0eCB9ID0gdGhpcztcclxuICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGN0eC5jYW52YXM7XHJcbiAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xyXG5cclxuICAgICAgICBsZXQgY29udGVudEZyYW1lID0gdGhpcy5nZXRDb250ZW50RnJhbWUoKTtcclxuICAgICAgICB0aGlzLnN0cm9rZUZyYW1lRm9yVGVzdChjb250ZW50RnJhbWUsICdibHVlJyk7XHJcbiAgICAgICAgaWYgKGNoYXJ0T3B0aW9ucy5zaG93VGl0bGUgJiYgY2hhcnRPcHRpb25zLnRpdGxlKVxyXG4gICAgICAgICAgICBjb250ZW50RnJhbWUgPSB0aGlzLmRyYXdUaXRsZShjaGFydE9wdGlvbnMudGl0bGUsIGNvbnRlbnRGcmFtZSk7XHJcbiAgICAgICAgaWYgKGNoYXJ0T3B0aW9ucy5zaG93TGVnZW5kKVxyXG4gICAgICAgICAgICBjb250ZW50RnJhbWUgPSB0aGlzLmRyYXdMZWdlbmQoY29udGVudEZyYW1lKTtcclxuICAgICAgICB0aGlzLnN0cm9rZUZyYW1lRm9yVGVzdChjb250ZW50RnJhbWUsICd5ZWxsb3cnKTtcclxuICAgICAgICByZXR1cm4gY29udGVudEZyYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBkcmF3R3JpZEhvcml6b250YWxMaW5lcyhzZXJpZXM6IE11bHRpU2VyaWVEYXRhW10sIGZyYW1lOiBGcmFtZVJlY3QpOiBUaWNrSW5mbyB7XHJcbiAgICAgICAgY29uc3QgeyBjdHggfSA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgTU9TVF9USUNLUyA9IDEwO1xyXG4gICAgICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KC4uLnNlcmllcy5tYXAoc2VyaWUgPT4gTWF0aC5tYXgoLi4uc2VyaWUudmFsdWVzKSkpO1xyXG4gICAgICAgIGNvbnN0IHRpY2tJbmZvID0gZ2V0VGlja0luZm8obWF4LCBNT1NUX1RJQ0tTKTtcclxuICAgICAgICBjb25zdCBzaW5nbGVIID0gZnJhbWUuaCAvIHRpY2tJbmZvLnRpY2tDb3VudCArIDE7XHJcbiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDM7XHJcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ2dyYXknO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRpY2tJbmZvLnRpY2tDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHkgPSBmcmFtZS55ICsgc2luZ2xlSCAqIGk7XHJcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgY3R4Lm1vdmVUbyhmcmFtZS54LCB5KTtcclxuICAgICAgICAgICAgY3R4LmxpbmVUbyhmcmFtZS54ICsgZnJhbWUudywgeSk7XHJcbiAgICAgICAgICAgIGN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGlja0luZm87XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgeyBUaWNrSW5mbyB9IGZyb20gXCIuL3R5cGVzXCI7XHJcblxyXG4vKipcclxuICogUmVzaXplIGNhbnZhcyB0byBkaXNwbGF5IHNpemUuXHJcbiAqIEBwYXJhbSBjYW52YXMgLSBjYW52YXMgb2JqZWN0LlxyXG4gKiBAcmV0dXJucyBmbGFnIGluZGljYXRpbmcgd2hldGhlciByZXNpemUgb2NjdXJlZC5cclxuKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc2l6ZUNhbnZhc1RvRGlzcGxheVNpemUoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3Qgd2lkdGggPSBjYW52YXMuY2xpZW50V2lkdGg7XHJcbiAgICBjb25zdCBoZWlnaHQgPSBjYW52YXMuY2xpZW50SGVpZ2h0O1xyXG4gICAgaWYgKGNhbnZhcy53aWR0aCAhPT0gd2lkdGggfHwgY2FudmFzLmhlaWdodCAhPT0gaGVpZ2h0KSB7XHJcbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpY2tJbmZvKGxhcmdlc3Q6IG51bWJlciwgbW9zdFRpY2tzOiBudW1iZXIpOiBUaWNrSW5mbyB7XHJcbiAgICBjb25zdCBtaW5pbXVtID0gbGFyZ2VzdCAvIG1vc3RUaWNrcztcclxuICAgIGNvbnN0IG1hZ25pdHVkZSA9IE1hdGgucG93KDEwLCBNYXRoLmZsb29yKE1hdGgubG9nMTAobWluaW11bSkpKTtcclxuICAgIGNvbnN0IHJlc2lkdWFsID0gbWluaW11bSAvIG1hZ25pdHVkZTtcclxuICAgIGNvbnN0IHRhYmxlID0gWzEsIDEuNSwgMiwgMywgNSwgNywgMTBdO1xyXG4gICAgY29uc3QgdGljayA9IHJlc2lkdWFsIDwgMTAgPyB0YWJsZS5maW5kKChlKSA9PiAoZSA+IHJlc2lkdWFsKSkgOiAxMDtcclxuICAgIGNvbnN0IHRpY2tIZWlnaHQgPSB0aWNrICogbWFnbml0dWRlO1xyXG4gICAgY29uc3QgdGlja0NvdW50ID0gTWF0aC5jZWlsKGxhcmdlc3QgLyB0aWNrSGVpZ2h0KTtcclxuICAgIHJldHVybiB7IHRpY2tIZWlnaHQsIHRpY2tDb3VudCB9O1xyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3Mge1xyXG4gICAgLyoqXHJcbiAgICAgKiBJZiBuZWVkZWQsIHNsaWNlICdhcnJheScgdG8gJ2xlbicgaXRlbXMgb3IgZmlsbCB0byAnbGVuJyBpdGVtcyB1c2luZyAnZmlsbFdpdGgnLlxyXG4gICAgICogQHBhcmFtIGFycmF5IC0gYXJyYXkgdG8gc2xpY2Ugb3IgZmlsbC5cclxuICAgICAqIEBwYXJhbSBsZW4gLSB0aGUgcmVzdWx0aW5nIGxlbmd0aCBvZiBhcnJheS5cclxuICAgICAqIEBwYXJhbSBmaWxsV2l0aCAtIG51bWJlciB3aXRoIHdoaWNoIGFycmF5IHNob3VsZCBiZSBmaWxsZWQuXHJcbiAgICAgKiBAcmV0dXJucyBzbGljZWQgb3IgZmlsbGVkIGFycmF5LlxyXG4gICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgc2xpY2VPckZpbGwoYXJyYXk6IG51bWJlcltdLCBsZW46IG51bWJlciwgZmlsbFdpdGg/OiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gbGVuKSByZXR1cm4gYXJyYXk7XHJcbiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA+IGxlbikgcmV0dXJuIGFycmF5LnNsaWNlKDAsIGxlbik7XHJcbiAgICAgICAgaWYgKGFycmF5Lmxlbmd0aCA8IGxlbilcclxuICAgICAgICAgICAgd2hpbGUgKGFycmF5Lmxlbmd0aCAhPT0gbGVuKVxyXG4gICAgICAgICAgICAgICAgYXJyYXkucHVzaChmaWxsV2l0aCA/PyAwKTtcclxuICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBNZXJnZSBwcm9wZXJ0aWVzIGZyb20gJ25ld09wdGlvbnMnIHRvICdhY3R1YWxPcHRpb25zJyAocmlnaHQtam9pbiBsaWtlKS5cclxuICAgICAqIEBwYXJhbSBuZXdPcHRpb25zIC0gc29tZSBvcHRpb24gcHJvcGVydGllcyBmb3IgdHlwZSBULlxyXG4gICAgICogQHBhcmFtIGFjdHVhbE9wdGlvbnMgLSBhbGwgb3B0aW9uIHByb3BlcnRpZXMgZm9yIHR5cGUgVC5cclxuICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIG1lcmdlUmlnaHQ8VD4obmV3T3B0aW9uczogUGFydGlhbDxUPiwgYWN0dWFsT3B0aW9uczogVCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhhY3R1YWxPcHRpb25zKTtcclxuICAgICAgICBPYmplY3QuZW50cmllcyhuZXdPcHRpb25zKS5mb3JFYWNoKHBhaXIgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBwYWlyWzBdO1xyXG4gICAgICAgICAgICBpZiAoa2V5cy5pbmNsdWRlcyhrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHBhaXJbMV07XHJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50IFxyXG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgYWN0dWFsT3B0aW9uc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFNlcmllRGF0YUNvbW1vbiwgQ2hhcnRPcHRpb25zLCBDb250ZXh0U291cmNlLCBTZXJpZU9wdGlvbnMgfSBmcm9tIFwiLi90eXBlc1wiO1xyXG5pbXBvcnQgUGxvdCBmcm9tIFwiLi4vcGxvdC9QbG90U2tlbGV0b25cIjtcclxuaW1wb3J0IENoYXJ0VXRpbHMgZnJvbSBcIi4vdXRpbHNcIjtcclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDaGFydCB7XHJcblxyXG4gICAgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG4gICAgc2VyaWVzRGF0YTogU2VyaWVEYXRhQ29tbW9uW107XHJcbiAgICBjaGFydE9wdGlvbnM6IENoYXJ0T3B0aW9ucztcclxuICAgIHBsb3Q6IFBsb3Q7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc291cmNlOiBDb250ZXh0U291cmNlKSB7XHJcbiAgICAgICAgbGV0IGFuYWx5emVkRWxlbWVudCA9IHNvdXJjZTtcclxuICAgICAgICBpZiAodHlwZW9mIGFuYWx5emVkRWxlbWVudCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgYW5hbHl6ZWRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYW5hbHl6ZWRFbGVtZW50LnJlcGxhY2UoJy9eIy8nLCAnJykpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYW5hbHl6ZWRFbGVtZW50IGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gYW5hbHl6ZWRFbGVtZW50LmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGFuYWx5emVkRWxlbWVudCBpbnN0YW5jZW9mIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSBhbmFseXplZEVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgdGhyb3cgRXJyb3IoJ0FyZ3VtZW50IG11c3QgYmUgdmFsaWQgSUQsIEhUTUxDYW52YXNFbGVtZW50IG9yIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCcpO1xyXG5cclxuICAgICAgICB0aGlzLmNoYXJ0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgdGl0bGU6ICdVbnRpdGxlZCcsXHJcbiAgICAgICAgICAgIHNob3dUaXRsZTogdHJ1ZSxcclxuICAgICAgICAgICAgc2hvd0xlZ2VuZDogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlcmllc0RhdGEgPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5wbG90ID0gbmV3IFBsb3QodGhpcy5jb250ZXh0KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0Q2hhcnRPcHRpb25zKG9wdGlvbnM6IFBhcnRpYWw8Q2hhcnRPcHRpb25zPik6IHZvaWQge1xyXG4gICAgICAgIENoYXJ0VXRpbHMubWVyZ2VSaWdodChvcHRpb25zLCB0aGlzLmNoYXJ0T3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFNlcmllT3B0aW9ucyhuZXdPcHRpb25zOiBQYXJ0aWFsPFNlcmllT3B0aW9ucz4sIHdoaWNoU2VyaWVzPzogc3RyaW5nW10pOiB2b2lkIHtcclxuICAgICAgICBpZiAod2hpY2hTZXJpZXMpIHdoaWNoU2VyaWVzLmZvckVhY2goKHNlcmllTmFtZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBhY3R1YWxTZXJpZSA9XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcmllc0RhdGEuZmluZCgoZXhpc3RpbmdTZXJpZSkgPT4gZXhpc3RpbmdTZXJpZS5uYW1lID09IHNlcmllTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChhY3R1YWxTZXJpZSkge1xyXG4gICAgICAgICAgICAgICAgQ2hhcnRVdGlscy5tZXJnZVJpZ2h0KG5ld09wdGlvbnMsIGFjdHVhbFNlcmllLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBTZXJpZSB3aXRoIG5hbWUgJHtzZXJpZU5hbWV9IG5vdCBmb3VuZC5gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGVsc2UgdGhpcy5zZXJpZXNEYXRhLmZvckVhY2goKHNlcmllKSA9PiBDaGFydFV0aWxzLm1lcmdlUmlnaHQobmV3T3B0aW9ucywgc2VyaWUub3B0aW9ucykpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBzZXQgWCh2YWx1ZTogc3RyaW5nW10gfCBudW1iZXJbXSB8IG51bWJlcltdW10pO1xyXG4gICAgcHVibGljIGFic3RyYWN0IHNldCBZKHZhbHVlOiBudW1iZXJbXSB8IG51bWJlcltdW10pO1xyXG4gICAgcHVibGljIGFic3RyYWN0IGRyYXcoKTogdm9pZDtcclxufSIsImltcG9ydCB7IENoYXJ0T3B0aW9ucywgTXVsdGlTZXJpZURhdGEgfSBmcm9tIFwiLi4vbW9kZWwvdHlwZXNcIjtcclxuaW1wb3J0IFBsb3RTa2VsZXRvbiBmcm9tIFwiLi9QbG90U2tlbGV0b25cIjtcclxuaW1wb3J0IHsgRnJhbWVSZWN0IH0gZnJvbSBcIi4vdHlwZXNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJhclBsb3QgZXh0ZW5kcyBQbG90U2tlbGV0b24ge1xyXG4gICAgY29uc3RydWN0b3Ioc2tlbGV0b246IFBsb3RTa2VsZXRvbikge1xyXG4gICAgICAgIHN1cGVyKHNrZWxldG9uLmN0eCk7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhd0Jhcih4cG9zOiBudW1iZXIsIHlwb3M6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGNvbG9yOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhjb2xvcik7XHJcbiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gY29sb3I7XHJcbiAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCh4cG9zLCB5cG9zLCB3aWR0aCwgaGVpZ2h0KTtcclxuICAgIH1cclxuXHJcbiAgICBkcmF3QmFycyhzZXJpZXM6IE11bHRpU2VyaWVEYXRhW10sIGNoYXJ0T3B0aW9uczogQ2hhcnRPcHRpb25zKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgQ09MX1NQQUNFX1NJWkUgPSAwLjc1O1xyXG4gICAgICAgIGNvbnN0IHsgY3R4IH0gPSB0aGlzO1xyXG4gICAgICAgIGNvbnN0IHBsb3RGcmFtZSA9IHRoaXMucHJlcGFyZUNoYXJ0Rm9yRHJhd2luZyhjaGFydE9wdGlvbnMpO1xyXG4gICAgICAgIGNvbnN0IHRpY2tJbmZvID0gdGhpcy5kcmF3R3JpZEhvcml6b250YWxMaW5lcyhzZXJpZXMsIHBsb3RGcmFtZSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGJhckNvdW50ID0gc2VyaWVzLmxlbmd0aDtcclxuICAgICAgICBjb25zdCBzaW5nbGVXID0gcGxvdEZyYW1lLncgLyBiYXJDb3VudDtcclxuICAgICAgICBjb25zdCBzaW5nbGVXV2l0aFBhZGRpbmcgPSBzaW5nbGVXICogQ09MX1NQQUNFX1NJWkU7XHJcbiAgICAgICAgY29uc3Qgc3BhY2VYID0gKHNpbmdsZVcgLSBzaW5nbGVXV2l0aFBhZGRpbmcpIC8gMjtcclxuICAgICAgICBjb25zdCBzZXJpZUNvdW50ID0gc2VyaWVzWzBdLnZhbHVlcy5sZW5ndGg7XHJcbiAgICAgICAgY29uc3Qgb25lQ29sdW1uV2lkdGggPSBzaW5nbGVXV2l0aFBhZGRpbmcgLyBzZXJpZUNvdW50ICogQ09MX1NQQUNFX1NJWkU7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXJpZUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBiYXJDb3VudDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoID0gc2VyaWVzW2pdLnZhbHVlc1tpXSAqIHBsb3RGcmFtZS5oIC8gdGlja0luZm8udGlja0NvdW50ICsgMTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd0JhcihcclxuICAgICAgICAgICAgICAgICAgICAocGxvdEZyYW1lLnggKyBqICogc2luZ2xlVyArIHNwYWNlWCkgKyAoaSAqIG9uZUNvbHVtbldpZHRoKSxcclxuICAgICAgICAgICAgICAgICAgICBwbG90RnJhbWUueSArIHBsb3RGcmFtZS5oIC0gaCxcclxuICAgICAgICAgICAgICAgICAgICBvbmVDb2x1bW5XaWR0aCxcclxuICAgICAgICAgICAgICAgICAgICBoLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlcmllc1tpXS5vcHRpb25zLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgTXVsdGlTZXJpZURhdGEsIENvbnRleHRTb3VyY2UgfSBmcm9tIFwiLi90eXBlc1wiO1xyXG5pbXBvcnQgeyBDaGFydCB9IGZyb20gXCIuL0NoYXJ0XCI7XHJcbmltcG9ydCBDaGFydFV0aWxzIGZyb20gXCIuL3V0aWxzXCI7XHJcbmltcG9ydCBCYXJQbG90IGZyb20gXCIuLi9wbG90L0JhclBsb3RcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBCYXJDaGFydCBleHRlbmRzIENoYXJ0IHtcclxuICAgIGRhdGFMYWJlbHM6IHN0cmluZ1tdO1xyXG4gICAgc2VyaWVzRGF0YTogTXVsdGlTZXJpZURhdGFbXTtcclxuICAgIHBsb3Q6IEJhclBsb3Q7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc291cmNlOiBDb250ZXh0U291cmNlKSB7XHJcbiAgICAgICAgc3VwZXIoc291cmNlKTtcclxuICAgICAgICB0aGlzLnBsb3QgPSBuZXcgQmFyUGxvdCh0aGlzLnBsb3QpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgWChsYWJlbHM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhTGFiZWxzID0gbGFiZWxzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgWShzZXJpZXM6IG51bWJlcltdW10pIHtcclxuICAgICAgICBjb25zdCB7IGxlbmd0aCB9ID0gdGhpcy5kYXRhTGFiZWxzO1xyXG4gICAgICAgIGlmICghbGVuZ3RoKVxyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignVmFsdWVzIG9uIFwiWFwiIGF4aXMgbXVzdCBiZSBzcGVjaWZpZWQgYmVmb3JlIHNldHRpbmcgXCJZXCIgdmFsdWVzLicpO1xyXG4gICAgICAgIGNvbnN0IG1hcHBlZFNlcmllcyA9IHNlcmllcy5tYXAoc2VyaWUgPT4gQ2hhcnRVdGlscy5zbGljZU9yRmlsbChzZXJpZSwgbGVuZ3RoKSk7XHJcbiAgICAgICAgdGhpcy5zZXJpZXNEYXRhID0gbWFwcGVkU2VyaWVzLm1hcCgoc2VyaWUsIGluZGV4KSA9PiB0aGlzLmdldERlZmF1bHRTZXJpZU9iamVjdChzZXJpZSwgaW5kZXgpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldERlZmF1bHRTZXJpZU9iamVjdChzZXJpZTogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpOiBNdWx0aVNlcmllRGF0YSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdmFsdWVzOiBzZXJpZSxcclxuICAgICAgICAgICAgbmFtZTogYHNlcmllJHtpbmRleH1gLFxyXG4gICAgICAgICAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTY3NzcyMTUpLnRvU3RyaW5nKDE2KSxcclxuICAgICAgICAgICAgICAgIHNob3dMYWJlbHM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc2hvd09uTGVnZW5kOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGVkZ2VUaGlja25lc3M6IDAsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucGxvdC5kcmF3QmFycyh0aGlzLnNlcmllc0RhdGEsIHRoaXMuY2hhcnRPcHRpb25zKTtcclxuICAgICAgICAvLyB0aGlzLmNoYXJ0RHJhZnRzbWFuLmRyYXdMaW5lcyh0aGlzLnNlcmllc0RhdGFbMF0udmFsdWVzKTtcclxuICAgICAgICAvLyB0aGlzLmNoYXJ0RHJhZnRzbWFuLmRyYXdCYXJzKHRoaXMuc2VyaWVzRGF0YVswXS52YWx1ZXMpO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgQ2hhcnRPcHRpb25zLCBTaW5nbGVTZXJpZURhdGEgfSBmcm9tIFwiLi4vbW9kZWwvdHlwZXNcIjtcclxuaW1wb3J0IFBsb3RTa2VsZXRvbiBmcm9tIFwiLi9QbG90U2tlbGV0b25cIjtcclxuaW1wb3J0IHsgUGllUGFydERhdGEgfSBmcm9tIFwiLi90eXBlc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGllUGxvdCBleHRlbmRzIFBsb3RTa2VsZXRvbiB7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc2tlbGV0b246IFBsb3RTa2VsZXRvbikge1xyXG4gICAgICAgIHN1cGVyKHNrZWxldG9uLmN0eCk7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhd1BpZShzZXJpZXM6IFNpbmdsZVNlcmllRGF0YVtdLCBjaGFydE9wdGlvbnM6IENoYXJ0T3B0aW9ucyk6IHZvaWQge1xyXG4gICAgICAgIC8vIHNob3VsZCBiZSAyIHRvIGZpbGwgd2hvbGUgYXZhaWxhYmxlIHNwYWNlXHJcbiAgICAgICAgY29uc3QgUkFESVVTX0RJVklERVIgPSAyLjU7XHJcbiAgICAgICAgY29uc3QgeyBjdHggfSA9IHRoaXM7XHJcbiAgICAgICAgY29uc3QgcGxvdEZyYW1lID0gdGhpcy5wcmVwYXJlQ2hhcnRGb3JEcmF3aW5nKGNoYXJ0T3B0aW9ucyk7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMubWFwU2VyaWVzVG9QaWVEZWdBbmRDb2xvcihzZXJpZXMpO1xyXG4gICAgICAgIGNvbnN0IHJhZGl1cyA9IE1hdGgubWluKHBsb3RGcmFtZS53LCBwbG90RnJhbWUuaCkgLyBSQURJVVNfRElWSURFUjtcclxuICAgICAgICBjb25zdCBjZW50ZXIgPSB7XHJcbiAgICAgICAgICAgIHg6IHBsb3RGcmFtZS54ICsgcGxvdEZyYW1lLncgLyAyLFxyXG4gICAgICAgICAgICB5OiBwbG90RnJhbWUueSArIHBsb3RGcmFtZS5oIC8gMlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbGV0IHRvdGFsID0gMDtcclxuICAgICAgICAvL2ZpbGxcclxuICAgICAgICBkYXRhLmZvckVhY2goZW50cnkgPT4ge1xyXG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZW50cnkuY29sb3I7XHJcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgY3R4Lm1vdmVUbyhjZW50ZXIueCwgY2VudGVyLnkpO1xyXG4gICAgICAgICAgICBjdHguYXJjKGNlbnRlci54LCBjZW50ZXIueSwgcmFkaXVzLCB0b3RhbCwgdG90YWwgKz0gZW50cnkucmFkKTtcclxuICAgICAgICAgICAgY3R4LmxpbmVUbyhjZW50ZXIueCwgY2VudGVyLnkpO1xyXG4gICAgICAgICAgICBjdHguZmlsbCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRvdGFsID0gMDtcclxuICAgICAgICAvL3N0cm9rZVxyXG4gICAgICAgIGRhdGEuZm9yRWFjaChlbnRyeSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlbnRyeS50aGlja25lc3MgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IGVudHJ5LnRoaWNrbmVzcztcclxuICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oY2VudGVyLngsIGNlbnRlci55KTtcclxuICAgICAgICAgICAgICAgIGN0eC5hcmMoY2VudGVyLngsIGNlbnRlci55LCByYWRpdXMsIHRvdGFsLCB0b3RhbCArPSBlbnRyeS5yYWQpO1xyXG4gICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhjZW50ZXIueCwgY2VudGVyLnkpO1xyXG4gICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdG90YWwgKz0gZW50cnkucmFkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtYXBTZXJpZXNUb1BpZURlZ0FuZENvbG9yKHNlcmllczogU2luZ2xlU2VyaWVEYXRhW10pOiBQaWVQYXJ0RGF0YVtdIHtcclxuICAgICAgICBjb25zdCB0b3RhbCA9IHNlcmllcy5tYXAoc2VyaWUgPT4gc2VyaWUudmFsdWUpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApO1xyXG4gICAgICAgIHJldHVybiBzZXJpZXMubWFwKHNlcmllID0+ICh7XHJcbiAgICAgICAgICAgIHJhZDogc2VyaWUudmFsdWUgKiAyICogTWF0aC5QSSAvIHRvdGFsLFxyXG4gICAgICAgICAgICBjb2xvcjogc2VyaWUub3B0aW9ucy5jb2xvcixcclxuICAgICAgICAgICAgdGhpY2tuZXNzOiBzZXJpZS5vcHRpb25zLmVkZ2VUaGlja25lc3NcclxuICAgICAgICB9KSk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsImltcG9ydCB7IFNpbmdsZVNlcmllRGF0YSwgQ29udGV4dFNvdXJjZSB9IGZyb20gXCIuL3R5cGVzXCI7XHJcbmltcG9ydCB7IENoYXJ0IH0gZnJvbSBcIi4vQ2hhcnRcIjtcclxuaW1wb3J0IENoYXJ0VXRpbHMgZnJvbSBcIi4vdXRpbHNcIjtcclxuaW1wb3J0IFBpZVBsb3QgZnJvbSBcIi4uL3Bsb3QvUGllUGxvdFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBpZUNoYXJ0IGV4dGVuZHMgQ2hhcnQge1xyXG5cclxuICAgIHNlcmllc0RhdGE6IFNpbmdsZVNlcmllRGF0YVtdO1xyXG4gICAgcGxvdDogUGllUGxvdDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2U6IENvbnRleHRTb3VyY2UpIHtcclxuICAgICAgICBzdXBlcihzb3VyY2UpO1xyXG4gICAgICAgIHRoaXMucGxvdCA9IG5ldyBQaWVQbG90KHRoaXMucGxvdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBYKGxhYmVsczogc3RyaW5nW10pIHtcclxuICAgICAgICB0aGlzLnNlcmllc0RhdGEgPVxyXG4gICAgICAgICAgICBsYWJlbHMubWFwKChsYWJlbCkgPT4gdGhpcy5nZXREZWZhdWx0U2VyaWVPYmplY3QobGFiZWwpKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IFkodmFsdWVzOiBudW1iZXJbXSkge1xyXG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzLnNlcmllc0RhdGE7XHJcbiAgICAgICAgaWYgKCFsZW5ndGgpXHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdWYWx1ZXMgb24gXCJYXCIgYXhpcyBtdXN0IGJlIHNwZWNpZmllZCBiZWZvcmUgc2V0dGluZyBcIllcIiB2YWx1ZXMuJyk7XHJcbiAgICAgICAgY29uc3QgbWFwcGVkVmFsdWVzID0gQ2hhcnRVdGlscy5zbGljZU9yRmlsbCh2YWx1ZXMsIGxlbmd0aCk7XHJcbiAgICAgICAgdGhpcy5zZXJpZXNEYXRhLm1hcCgob3B0aW9uLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICBvcHRpb24udmFsdWUgPSBtYXBwZWRWYWx1ZXNbaW5kZXhdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0RGVmYXVsdFNlcmllT2JqZWN0KGxhYmVsOiBzdHJpbmcpOiBTaW5nbGVTZXJpZURhdGEge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHZhbHVlOiAwLFxyXG4gICAgICAgICAgICBuYW1lOiBsYWJlbCxcclxuICAgICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgY29sb3I6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2Nzc3MjE1KS50b1N0cmluZygxNiksXHJcbiAgICAgICAgICAgICAgICBzaG93TGFiZWxzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNob3dPbkxlZ2VuZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBlZGdlVGhpY2tuZXNzOiAwLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhdygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnBsb3QuZHJhd1BpZSh0aGlzLnNlcmllc0RhdGEsIHRoaXMuY2hhcnRPcHRpb25zKTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IENvbnRleHRTb3VyY2UgfSBmcm9tIFwiLi4vbW9kZWwvdHlwZXNcIjtcclxuaW1wb3J0IHsgQmFyQ2hhcnQgfSBmcm9tIFwiLi4vbW9kZWwvQmFyQ2hhcnRcIjtcclxuaW1wb3J0IHsgQ2hhcnQgfSBmcm9tIFwiLi4vbW9kZWwvQ2hhcnRcIjtcclxuaW1wb3J0IHsgUGllQ2hhcnQgfSBmcm9tIFwiLi4vbW9kZWwvUGllQ2hhcnRcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHNlcnZlQ2hhcnQodHlwZTogc3RyaW5nLCBzb3VyY2U6IENvbnRleHRTb3VyY2UpOiBDaGFydCB7XHJcbiAgICBzd2l0Y2ggKHR5cGUudG9Mb3dlckNhc2UoKS50cmltKCkpIHtcclxuICAgICAgICBjYXNlIFwicGllXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGllQ2hhcnQoc291cmNlKTtcclxuICAgICAgICBjYXNlIFwiYmFyXCI6XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQmFyQ2hhcnQoc291cmNlKTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dHlwZX0gY2hhcnQgaXMgbm90IGRlZmluZWQuYCk7XHJcbiAgICB9XHJcbn0iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJQbG90U2tlbGV0b24iLCJjb25zdHJ1Y3RvciIsImN0eCIsInRoaXMiLCJzdHJva2VGcmFtZUZvclRlc3QiLCJmcmFtZSIsImNvbG9yIiwic3Ryb2tlU3R5bGUiLCJzdHJva2VSZWN0IiwieCIsInkiLCJ3IiwiaCIsImdldENvbnRlbnRGcmFtZSIsIndpZHRoIiwiaGVpZ2h0IiwiY2FudmFzIiwicGFkZGluZyIsIk1hdGgiLCJmbG9vciIsIm1pbiIsImdldFRpdGxlRnJhbWUiLCJjb250ZW50RnJhbWUiLCJuZXdIIiwiZ2V0UmVtYWluaW5nQ29udGVudEZyYW1lIiwicHJldiIsInJlY2VudCIsImdldExlZ2VuZEZyYW1lIiwiZHJhd1RpdGxlIiwidGl0bGUiLCJ0aXRsZUZyYW1lIiwiZm9udCIsInRleHRNZWFzdXJlbWVudCIsIm1lYXN1cmVUZXh0IiwidGV4dFBvc2l0aW9uWCIsInRleHRQb3NpdGlvblkiLCJhY3R1YWxCb3VuZGluZ0JveEFzY2VudCIsImZpbGxUZXh0IiwiZHJhd0xlZ2VuZCIsImxlZ2VuZEZyYW1lIiwicHJlcGFyZUNoYXJ0Rm9yRHJhd2luZyIsImNoYXJ0T3B0aW9ucyIsImNsZWFyUmVjdCIsInNob3dUaXRsZSIsInNob3dMZWdlbmQiLCJkcmF3R3JpZEhvcml6b250YWxMaW5lcyIsInNlcmllcyIsInRpY2tJbmZvIiwibGFyZ2VzdCIsIm1vc3RUaWNrcyIsIm1pbmltdW0iLCJtYWduaXR1ZGUiLCJwb3ciLCJsb2cxMCIsInJlc2lkdWFsIiwidGlja0hlaWdodCIsImZpbmQiLCJlIiwidGlja0NvdW50IiwiY2VpbCIsImdldFRpY2tJbmZvIiwibWF4IiwibWFwIiwic2VyaWUiLCJ2YWx1ZXMiLCJzaW5nbGVIIiwibGluZVdpZHRoIiwiaSIsImJlZ2luUGF0aCIsIm1vdmVUbyIsImxpbmVUbyIsInN0cm9rZSIsImNsb3NlUGF0aCIsInN0YXRpYyIsImFycmF5IiwibGVuIiwiZmlsbFdpdGgiLCJsZW5ndGgiLCJzbGljZSIsInB1c2giLCJuZXdPcHRpb25zIiwiYWN0dWFsT3B0aW9ucyIsImtleXMiLCJlbnRyaWVzIiwiZm9yRWFjaCIsInBhaXIiLCJpbmNsdWRlcyIsInZhbHVlIiwiQ2hhcnQiLCJzb3VyY2UiLCJhbmFseXplZEVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwicmVwbGFjZSIsIkhUTUxDYW52YXNFbGVtZW50IiwiY29udGV4dCIsImdldENvbnRleHQiLCJDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQiLCJFcnJvciIsInNlcmllc0RhdGEiLCJwbG90Iiwic2V0Q2hhcnRPcHRpb25zIiwib3B0aW9ucyIsInNldFNlcmllT3B0aW9ucyIsIndoaWNoU2VyaWVzIiwic2VyaWVOYW1lIiwiYWN0dWFsU2VyaWUiLCJleGlzdGluZ1NlcmllIiwibmFtZSIsImNvbnNvbGUiLCJ3YXJuIiwiQmFyUGxvdCIsInNrZWxldG9uIiwic3VwZXIiLCJkcmF3QmFyIiwieHBvcyIsInlwb3MiLCJsb2ciLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImRyYXdCYXJzIiwicGxvdEZyYW1lIiwiYmFyQ291bnQiLCJzaW5nbGVXIiwic2luZ2xlV1dpdGhQYWRkaW5nIiwic3BhY2VYIiwic2VyaWVDb3VudCIsIm9uZUNvbHVtbldpZHRoIiwiaiIsIkJhckNoYXJ0IiwiWCIsImxhYmVscyIsImRhdGFMYWJlbHMiLCJZIiwibWFwcGVkU2VyaWVzIiwiaW5kZXgiLCJnZXREZWZhdWx0U2VyaWVPYmplY3QiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNob3dMYWJlbHMiLCJzaG93T25MZWdlbmQiLCJlZGdlVGhpY2tuZXNzIiwiZHJhdyIsIlBpZVBsb3QiLCJkcmF3UGllIiwiZGF0YSIsIm1hcFNlcmllc1RvUGllRGVnQW5kQ29sb3IiLCJyYWRpdXMiLCJjZW50ZXIiLCJ0b3RhbCIsImVudHJ5IiwiYXJjIiwicmFkIiwiZmlsbCIsInRoaWNrbmVzcyIsInJlZHVjZSIsImEiLCJiIiwiUEkiLCJQaWVDaGFydCIsImxhYmVsIiwibWFwcGVkVmFsdWVzIiwib3B0aW9uIiwic2VydmVDaGFydCIsInR5cGUiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iXSwic291cmNlUm9vdCI6IiJ9